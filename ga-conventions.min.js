!function(a,b){"use strict";return"function"==typeof define&&define.amd?void define(["angular"],function(a){return b(a)}):b(a)}(angular||null,function(a){"use strict";var b=a.module("ngAmbassador",["ambassador.constants","ui.bootstrap","angularSpinner","restangular","smartTable.table","ambassador.table.filters","angles","duScroll"]).directive("gaSelect",["$api",function(a){return{restrict:"E",scope:{model:"=",data:"=",endpoint:"@",multi:"@",label:"@",placeholder:"@",comparator:"@",search:"&"},templateUrl:"../ambassador/templates/directive.chooser.html",replace:!1,link:function(b,c,d){b.dropdown={isEnabled:!1,isOpen:!1},b.loadingItems=!1,b.originalPlaceholder=b.placeholder,b.multi!==!0&&b.model[b.label]&&(b.placeholder=b.model[b.label]),b.$watch("data",function(a){a&&a.length<25&&(b.dropdown.isEnabled=!0)}),b.removeItem=function(a){var c=b.model.indexOf(a);b.model.splice(c,1)},b.addItem=function(a){b.multi?(b.model.push(a),b.selected=""):(b.model=a,b.placeholder=b.model[b.label],b.showReset=!0),b.dropdown.isOpen=!1},b.resetField=function(){b.model={},b.placeholder=b.originalPlaceholder,b.showReset=!1},b.searchFunction=d.search?function(a){var c=b.search({val:a});return c}:function(c){return b.loadingItems=!0,a.all(b.endpoint).getList({search:c}).then(function(a){var c=[];if(b.model.length>0)for(var d=0;d<a.length;d++){var e=b.filterChosen(a[d]);e&&c.push(e)}else c=a;return b.loadingItems=!1,c})},b.filterChosen=function(a){if(0===b.model.length)return a;for(var c=!0,d=0,e=b.model.length;e>d;d++)b.comparator||a!==b.model[d]?b.comparator&&a[b.comparator]===b.model[d][b.comparator]&&(c=!1):c=!1;return c?a:!1}}}}]).directive("gaButton",function(){return{restrict:"E",transclude:!0,scope:{color:"@",size:"@",loading:"=",buttonDisabled:"=",buttonClick:"&",buttonName:"@"},template:'<button class="btn btn-{{color}} {{btnSize}}" ng-disabled="buttonDisabled || loadingDisabled" ng-click="buttonClick({button: buttonName})"><span ng-class="{ loading: loading }" ng-transclude></span><span ng-show="loading" class="btn-spinner" us-spinner="btnSpinner"></span></button>',link:function(a){switch(a.btnClick=null,a.loadingDisabled=!1,a.btnSize="",a.btnSpinner={},a.size){case"sm":a.btnSpinner={radius:4,width:3,length:4,lines:9};break;case"md":a.btnSpinner={radius:5,width:3,length:4,lines:10};break;case"lg":a.btnSpinner={radius:9,width:5,length:5,lines:11}}switch(a.color){case"primary":case"gray":case"danger":a.btnSpinner.color="#ffffff";break;case"default":a.btnSpinner.color="#666666"}a.$watch("loading",function(b){a.loadingDisabled=b?!0:!1}),"md"!==a.size&&(a.btnSize="btn-"+a.size)}}}).factory("$validationUtilities",["$q","$api",function(a,b){return{doesAmbassadorEmailExist:function(c,d){var e=a.defer();return c===d?e.resolve():b.all("ambassadors").getList({email:c}).then(function(a){a.count>=1&&c!==d?e.reject("This email address already exists."):e.resolve()}),e.promise},doesTeamMemberExist:function(c,d){var e=a.defer();return c===d?e.resolve():b.all("team").getList({email:c}).then(function(a){a.count>=1&&c!==d?e.reject("Email address is already in use by another user."):e.resolve()}),e.promise},dropdownItemSelected:function(b){var c=a.defer();return void 0===b?c.reject("You must make a selection."):c.resolve(),c.promise},gaSelectItemSelected:function(b){function c(a){var b;for(b in a)return!1;return!0}var d=a.defer();return 0===b.length||c(b)?d.reject("You must make a selection."):d.resolve(),d.promise},isInteger:function(b){var c=a.defer(),d=/^-?\d+$/;return d.test(b)?c.resolve():c.reject("Invalid number.  Please enter a whole number."),c.promise},isIntegerOrFloat:function(b){var c=a.defer(),d=/^-?\d+\.?\d+?$/,e=/^-?\d+$/;return d.test(b)||e.test(b)?c.resolve():c.reject("Invalid format.  Please enter a whole or decimal number."),c.promise},isLessThanMaxLength:function(b,c,d){var e=a.defer();return b.length>d.maxLength?e.reject("You may only use up to "+d.maxLength+" characters."):e.resolve(),e.promise},isLessThanMaxNumber:function(b,c,d){var e=a.defer(),f=parseInt(b,10);return f>d.maxNumber?e.reject("Number cannot be larger than "+d.maxNumber+"."):e.resolve(),e.promise},isNotEmpty:function(b){var c=a.defer();return b.toString().length>0?c.resolve():c.reject("The field must not be empty."),c.promise},isNotFutureDate:function(b){var c=a.defer(),d=new Date,e=!1;if(b instanceof Array)for(var f=0;f<b.length;f++){if(new Date(b[f]).setHours(0,0,0,0)>d.setHours(0,0,0,0)){c.reject(),e=!0;break}f!==b.length-1||e||c.resolve()}else new Date(b).setHours(0,0,0,0)>d.setHours(0,0,0,0)?c.reject():c.resolve();return c.promise},isValidCreditCard:function(b){var c=a.defer();/[^0-9-\s]+/.test(b)&&c.reject("Invalid credit card number.");var d=0,e=0,f=!1;b=b.replace(/\D/g,"");for(var g=b.length-1;g>=0;g--){var h=b.charAt(g);e=parseInt(h,10),f&&(e*=2)>9&&(e-=9),d+=e,f=!f}return d%10===0?c.resolve():c.reject("Invalid credit card number."),c.promise},isValidEmail:function(b){var c=a.defer(),d=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return d.test(b)?c.resolve():c.reject("Invalid email address."),c.promise},isValidUrl:function(b){var c=a.defer(),d=/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;return d.test(b)?c.resolve():c.reject('Invalid url.  Please use the format "http(s)://url.com".'),c.promise},isValidUrlWithoutProtocol:function(b){var c=a.defer(),d=/^(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;return d.test(b)?c.resolve():c.reject('Invalid url.  Please use the format "url.com or subdomain.url.com".'),c.promise},isZipCode:function(b){var c=a.defer(),d=/^\d{5}([\-]?\d{4})?$/;return d.test(b)?c.resolve():c.reject("Invalid zip code.  Please follow the XXXXX-XXXX format (with last 4 digits optional)."),c.promise},validDollarAmount:function(b){var c=a.defer(),d=/^-?\d{1,6}\.?\d{1,2}?$/,e=/^-?\d+$/;return d.test(b)||e.test(b)?c.resolve():c.reject("Invalid format.  Please enter a whole number, or a number in the format 'xx.xx'."),c.promise},validEmailOrShortcode:function(c){var d=a.defer(),e="",f=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,g={},h=f.test(c)?"email":"short_code";return g[h]=c,e="email"===h?"Referring ambassador with this email does not exist.":"Short code does not exist or the email is incomplete.",b.all("ambassadors").getList(g).then(function(a){0===a.count?d.reject(e):d.resolve()},function(){d.reject(e)}),d.promise}}}]).directive("gaFormField",["$q","$timeout","$compile",function(b,c,d){return{restrict:"E",replace:!0,scope:{isDisabled:"=?",extraClasses:"@",fieldType:"@?",helpText:"@?",label:"@?",defaultDropdownText:"@?",model:"=?",modelValue:"@",modelText:"@",additionalParams:"=",selectFunction:"=?",options:"=?",pristine:"=",required:"@?",monthDropdown:"@?",requiredText:"@?",rules:"=?",stateClasses:"=?",validatedField:"=",validationThreshold:"@?"},link:function(b,e){function f(){var a="",c="password"===b.fieldType?"type='password'":"type='text'",d=void 0!==b.isDisabled?"ng-disabled='disableField'":"";a="<input ng-model='model' class='form-control' "+c+" "+d+">",a+="<span class='help-block'>{{ helpText }}</span><i ng-show=\"state=='working'\" class='fa fa-refresh fa-spin'></i><i ng-show=\"state=='success'\" class='fa fa-check'></i><i ng-show=\"state=='error'\" class='fa fa-exclamation'></i>";var e="<textarea ng-model='model' class='form-control'></textarea><span class='help-block'>{{ helpText }}</span>",f="<div class='form-group {{ extraClasses }}'>  <label>{{ label }}</label>  <div class='async-loader'>",g="";if(b.options){if(b.dropdown={isOpen:!1},"simple-select"===b.fieldType){var h=b.modelValue?b.modelValue:"value",i=b.modelText?b.modelText:"text";g='<div class="dropdown dropdown-select dropdown-form"><a class="dropdown-toggle btn btn-default"><span ng-if="monthDropdown && model">{{model.'+h+"}} - </span>{{model."+i+'}} <i class="fa fa-caret-down"></i></a><ul class="dropdown-menu"><li ng-repeat="o in options"><a ng-click="selectOption(o)"><span ng-if="monthDropdown">{{o.'+h+"}} - </span>{{o."+i+"}}</a></li></ul></div>"}else g='<div class="dropdown dropdown-select dropdown-form" is-open="dropdown.isOpen"><a class="dropdown-toggle btn btn-default">{{modelLabel || defaultDropdownText || "Select one"}} <i class="fa fa-caret-down"></i></a><ul class="dropdown-menu"><li ng-repeat="o in options"><a ng-click="selectItem(o)">{{o.name}}</a></li></ul></div>';g+="<span class='help-block'>{{ helpText }}</span>"}return f+="textarea"===b.fieldType?e:"select"===b.fieldType||"simple-select"===b.fieldType?g:"ga-select"===b.fieldType?'<ga-select model="model" endpoint="{{additionalParams.config.endpoint}}" comparator="{{additionalParams.config.comparator}}" data="additionalParams.config.data" multi="{{additionalParams.config.multi}}" placeholder="{{additionalParams.config.placeholder}}" label="{{additionalParams.config.label}}"></ga-select><span class="help-block">{{ helpText }}</span>':a,f+="  </div></div>"}function g(c){a.forEach(b.options,function(a){c===a.value&&(b.modelLabel=a.name)}),a.isUndefined(b.modelLabel)&&(b.modelLabel="Select referral type")}function h(){return e.find("password"===b.fieldType?"input":"simple-select"===b.fieldType?"select":b.fieldType)}function i(){("select"===b.fieldType||"simple-select"===b.fieldType)&&p.bind("change",m),"ga-select"!==b.fieldType&&(p.bind("blur keyup",function(a){u&&c.cancel(u),"blur"===a.type?m(a):u=c(function(){""!==p[0].value&&m(a)},1500)}),p.bind("focus",function(){o&&(s=a.copy(b.model),o=!1)}))}function j(a){c(function(){b.state="error",b.helpText=a,b.validatedField=!1,e.addClass(b.stateClasses.error),q.addClass(b.stateClasses.error)})}function k(){if(void 0===b.stateClasses)b.stateClasses=n;else for(var a in n)b.stateClasses.hasOwnProperty(a)||(b.stateClasses[a]=n[a]);b.validationThreshold=void 0===b.validationThreshold?1:parseInt(b.validationThreshold,10),t="true"===b.required?!0:!1}function l(){b.state="success",b.helpText=r,e.removeClass(b.stateClasses.error),b.validatedField=!0,e.addClass(b.stateClasses.success),q.removeClass(b.stateClasses.error)}function m(c){var d=null,f=null,g=!0;if("select"===b.fieldType)d=b.model;else if("simple-select"===b.fieldType)d=""===b.model?"":b.model.text;else if("ga-select"===b.fieldType)d=b.model;else if(void 0!==c.target)try{d=c.srcElement.value}catch(h){d=c.target.value}else d=b.model;if(b.validatedField=!0,b.pristine=!1,t===!0&&""===d)j(b.requiredText?b.requiredText:"This field is required.");else if(""!==d)b.state="working",("change"===c.type||"blur"===c.type||void 0!==d&&d.toString().length>=b.validationThreshold||void 0!==d)&&(a.forEach(b.rules,function(a){g?(f=a(d,s,b.additionalParams),g=!1):f=f.then(function(){return a(d,s,b.additionalParams)})}),b.rules.length>0&&(void 0!==b.additionalParams&&void 0!==b.additionalParams.errorMessage?f.then(l,j(b.additionalParams.errorMessage)):f.then(l,j)));else{for(var i in b.stateClasses)e.removeClass(b.stateClasses[i]),q.removeClass(b.stateClasses[i]);b.state="",b.$apply(function(a){a.helpText=void 0===r?"":r}),b.validatedField=!0}}b.disableField=!1,b.$watch("isDisabled",function(){b.disableField=b.isDisabled}),b.selectItem=function(a){b.modelLabel=a.name,b.model=a.value,b.dropdown.isOpen=!1,m("change")},b.selectOption=function(a){b.model=a,m("change")},b.$watch("model",function(c,d){void 0!==b.additionalParams&&b.additionalParams.config&&c!==d&&m("change"),a.isDefined(b.model)&&"select"===b.fieldType&&g(b.model)},!0),void 0===b.fieldType&&(b.fieldType="input"),e.html(f()),d(e.contents())(b);var n={error:"has-error",success:"has-success",working:"working"},o=!0,p=h(),q=e.find("label"),r=b.helpText,s="",t=null,u=null;k(),i()}}}]).factory("$alertMap",function(){return{createNew:function(){var a={app:null,page:null,form:null};return{getSystem:function(b,c){if(null===a[b])return a[b]={},!1;for(var d in a[b])if(d===c)return a[b][d];return!1},createSystem:function(b,c,d){return void 0===d&&(d=null),a[b][c]={update:d,alerts:[]},a[b][c]},registerUpdate:function(b,c,d){return a[b][c].update=d,a[b][c]},removeSystem:function(b,c){delete a[b][c]},addAlert:function(b,c,d){a[b][c].alerts.push(d)},removeAlert:function(a,b,c){var d=this.getSystem(a,b);return d.alerts.splice(c,1)},getIndex:function(b){return a[b.type][b.name].alerts.indexOf(b)}}}}}).factory("$alertStack",["$document","$compile","$timeout","$alertMap",function(b,c,d,e){function f(a){d(function(){j.close(a)},a.timerVal)}function g(d){var e=b.find("body").eq(0),f=a.element("<alert-system></alert-system>");f.attr("type",d.type),f.attr("name",d.name),f.addClass("page");var g=c(f)(d.scope);e.append(g)}function h(a,b){i.addAlert(b.type,b.name,b),b.timer&&f(b),null!==a.update&&a.update(a.alerts)}var i=e.createNew(),j={};return j.getAlerts=function(a,b){var c=i.getSystem(a,b);return c.alerts},j.registerSystem=function(a,b,c){var d=i.getSystem(a,b);return d&&null!==d.update?c(d.alerts):d&&null===d.update?(d=i.registerUpdate(a,b,c),c(d.alerts)):(d=i.createSystem(a,b,c),void 0!==c&&c(d.alerts)),d},j.deleteSystem=function(a,b){i.removeSystem(a,b)},j.add=function(a,c){var e,f=i.getSystem(a.type,a.name);!f&&a.register?(f=j.registerSystem(a.type,a.name),h(f,a)):f||a.register||void 0!==c?f||a.register||!c?h(f,a):(g(a),e=setInterval(function(){f=i.getSystem(a.type,a.name),f&&(clearInterval(e),h(f,a))},500)):d(function(){j.add(a,!0)},500),a.scroll&&b.scrollTo(0,0,500)},j.close=function(a,b){void 0===b&&(b=i.getIndex(a)),i.removeAlert(a.type,a.name,b),null!==a.callback&&a.callback()},j}]).provider("$alert",function(){var b={options:{style:"info",type:"page",name:void 0,register:!1,text:"",timer:!0,timerVal:4e3,callback:null,scroll:!0},$get:["$rootScope","$alertStack",function(c,d){var e={};return e.add=function(e){e=a.extend({},b.options,e);var f=(e.scope||c).$new();d.add({scope:f,style:e.style,type:e.type,name:e.name,register:e.register,text:e.text,timer:e.timer,timerVal:e.timerVal,callback:e.callback,scroll:e.scroll})},e.clearAll=function(b,c){var e=d.getAlerts(b,c),f=[];a.forEach(e,function(a){f.push(a)}),a.forEach(f,function(a){d.close(a)})},e}]};return b}).directive("alertSystem",["$alertStack","$timeout",function(b,c){return{restrict:"EA",template:'<div class="alert-system-inner"><alert ng-repeat="alert in alerts" type="{{alert.style}}" close="closeAlert(alert, $index)">{{alert.text}}</alert></div>',scope:{type:"@",name:"@"},link:function(d,e){var f=a.isDefined(d.type)?d.type:"page",g=a.isDefined(d.name)?d.name:null,h=function(a){c(function(){d.alerts=a})};b.registerSystem(f,g,h),e.addClass("alert-system"),"page"===f?e.addClass("page"):"app"===f&&e.addClass("app"),d.closeAlert=function(a,c){b.close(a,c)},d.$on("$destroy",function(){var a=b.getAlerts(f,g);0===a.length&&b.deleteSystem(f,g)})}}}]).directive("gaLineChart",[function(){return{restrict:"E",templateUrl:"../ambassador/templates/charts/line-chart.html",replace:!1,scope:{config:"=",height:"@",width:"@"},link:function(a){a.chartHeight=a.height?a.height:"150",a.chartWidth=a.width?a.width:"300",a.chart={},a.options={},a.chart.labels=a.config.labels,a.chart.datasets=[];for(var b=0;b<a.config.datasets.length;b++){var c={active:!0,label:a.config.datasets[b].label,fillColor:"rgba(255,255,255,0)",strokeColor:a.config.datasets[b].color,pointColor:a.config.datasets[b].color,pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:a.config.datasets[b].color,data:a.config.datasets[b].data};a.chart.datasets.push(c)}a.chartCopy=JSON.parse(JSON.stringify(a.chart)),a.toggleDataset=function(b){a.chartCopy.datasets[b].active=a.chartCopy.datasets[b].active?!1:!0;for(var c=[],d=0,e=0;e<a.chartCopy.datasets.length;e++)a.chartCopy.datasets[e].active===!0&&(c.push(a.chartCopy.datasets[e]),d++);d>0?a.chart.datasets=JSON.parse(JSON.stringify(c)):a.chartCopy.datasets[b].active=a.chartCopy.datasets[b].active?!1:!0}}}}]).directive("gaDoughnutChart",["$helper",function(a){return{restrict:"E",templateUrl:"../ambassador/templates/charts/doughnut-chart.html",replace:!1,scope:{config:"=",responsive:"="},link:function(b){b.chartData=[],b.chartDataCopy=[],b.chartLeftLabels=[],b.chartRightLabels=[],b.chartResponsive=void 0===b.responsive?!0:b.responsive,b.options={};for(var c=a.sum(b.config.datasets,"value"),d=0;d<b.config.datasets.length;d++){var e={active:!0,label:b.config.datasets[d].label,iconClass:b.config.datasets[d].iconClass,highlight:a.colorLuminance(b.config.datasets[d].color,.1),color:b.config.datasets[d].color,value:b.config.datasets[d].value,percent:Math.round(b.config.datasets[d].value/c*100),id:d};b.chartData.push(e),d<Math.ceil(b.config.datasets.length/2)&&b.chartLeftLabels.push(e),d>=Math.ceil(b.config.datasets.length/2)&&b.chartRightLabels.push(e)}b.chartDataCopy=JSON.parse(JSON.stringify(b.chartData)),b.toggleDataset=function(a){b.chartDataCopy[a].active=b.chartDataCopy[a].active?!1:!0;for(var c=[],d=0,e=0;e<b.chartDataCopy.length;e++)b.chartDataCopy[e].active===!0&&(c.push(b.chartDataCopy[e]),d++);d>0?b.chartData=JSON.parse(JSON.stringify(c)):b.chartDataCopy[a].active=b.chartDataCopy[a].active?!1:!0},b.checkActive=function(a){return b.chartDataCopy[a].active}}}}]).directive("gaLoader",[function(){return{restrict:"E",replace:!0,template:'<div ng-class="{\'fade-in\':loading===true, \'fade-out\':loading===false }" class="ga-loader"><div class="ga-spinner"><span class="loader-text">Loading</span><svg class="spinner" width="100px" height="100px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg"><circle class="path" fill="none" stroke-width="5" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div>',scope:{loading:"="},link:function(){}}}]).directive("gaStatBoxOne",[function(){return{restrict:"E",replace:!0,templateUrl:"../ambassador/templates/stats/stats.box-1.html",scope:{boxes:"="},link:function(){}}}]).directive("gaStatBoxTwo",[function(){return{restrict:"E",replace:!0,templateUrl:"../ambassador/templates/stats/stats.box-2.html",scope:{boxes:"="},link:function(){}}}]).directive("gaStatBoxThree",[function(){return{restrict:"E",replace:!0,templateUrl:"../ambassador/templates/stats/stats.box-3.html",scope:{boxes:"="},link:function(){}}}]).directive("gaValueTemplate",["$compile",function(b){return{restrict:"E",scope:{value:"=",responsive:"=",compression:"=",min:"=",max:"=",scopeLevel:"@"},replace:!0,template:"<div ng-style='{fontSize:fontSize}'></div>",link:function(c,d,e){d.html(c.value),void 0===c.scopeLevel&&(c.scopeLevel=3);for(var f=c,g=1;g<=c.scopeLevel;g++)f=f.$parent;b(d.contents())(f),c.compressor=e.compression||1,c.minFontSize=e.min||Number.NEGATIVE_INFINITY,c.maxFontSize=e.max||Number.POSITIVE_INFINITY,c.elementWidth=d[0].offsetWidth,c.resizer=function(){c.elementWidth=d[0].offsetWidth,c.fontSize=Math.max(Math.min(c.elementWidth/(10*c.compressor),parseFloat(c.maxFontSize)),parseFloat(c.minFontSize))+"px"},c.responsive&&(c.resizer(),c.$watch("value",function(){c.resizer()}),a.element(window).bind("resize",function(){c.$apply(c.resizer)}))}}}]).factory("$helper",function(){return{colorLuminance:function(a,b){a=String(a).replace(/[^0-9a-f]/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0;var c,d,e="#";for(d=0;3>d;d++)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e},sum:function(a,b){for(var c=0,d=0;d<a.length;d++)c+=parseFloat(a[d][b]);return c}}}).factory("$errors",["$alert",function(b){return{output:function(c,d){var e=[],f=!1;if(d&&"object"==typeof d){for(var g in d)"detail"===g?e.push(d[g]):"non_field_errors"===g?e.push(d[g][0]):f=!0;f===!0&&e.push("Please ensure all required fields are properly completed.")}else e.push(a.isDefined(c.defaultMessage)?c.defaultMessage:"Something went wrong. Please try again or contact support.");for(var h=0;h<e.length;h++)if(2>h){var i={type:c.alertSystemType?c.alertSystemType:"page",name:c.alertSystem,scroll:void 0===c.alertScroll||c.alertScroll===!0?!0:!1,timer:void 0===c.alertTimer||c.alertScroll===!0?!0:!1,register:!0,style:"danger",text:e[h]};"page"===i.type&&(i.register=!1),b.add(i)}}}}]).factory("$api",["Restangular","API_URL","TOKEN",function(b,c,d){return b.withConfig(function(b){b.setBaseUrl(c),b.setDefaultHeaders({Authorization:"Token "+d}),b.setRestangularFields({id:"uid"}),b.setResponseExtractor(function(b,c){var d;return"getList"===c?a.isDefined(b.count)?(d=b.results,d.count=b.count,d.next=b.next,d.previous=b.previous):(d=b,d.count=_.size(b)):d=b,d})})}]).directive("gaCurrency",["$filter",function(a){return{restrict:"E",replace:!0,scope:!0,template:"<div>{{amount}}</div>",link:function(b,c,d){var e={USD:"$",GBP:"£",SGD:"$",EUR:"€",AUD:"$",ZAR:"R",BRL:"R$",CAD:"$"};switch(d.type){case"N":case"M":b.amount=d.amount+" "+d.pointsLabel;break;case"F":case"P":var f=a("currency"),g=parseFloat(d.amount);b.amount=f(g,e[d.currency],2);break;default:b.amount=d.amount}}}}]).directive("gaActivityFeed",["$api","$timeout",function(b){return{restrict:"E",scope:{endpoint:"@",numberOfItems:"@",columns:"@",feedTitle:"@",companyCurrency:"@",companyPoints:"@",ambassadorTemplate:"=",config:"=",filters:"="},templateUrl:"../ambassador/templates/activity-feed.html",link:function(c){function d(b){for(var d=0;d<c.columns;d++)c.feedColumns.push([]),a.forEach(b,function(a,b){b>=f*d&&f*(d+1)>b&&(a.orientation="right",c.feedColumns[d].push(a))})}function e(b){a.forEach(b,function(a,c){a.orientation=0===c?"left":a.type!==b[c-1].type?"left"===b[c-1].orientation?"right":"left":b[c-1].orientation})}c.activities=[],c.feedColumns=[],c.loadingActivities=!0;var f=Math.ceil(c.numberOfItems/c.columns),g=void 0!==c.filters?c.filters:{};g.page_size=c.numberOfItems,b.all(c.endpoint).getList(g).then(function(a){c.loadingActivities=!1,c.activities=a,1==c.columns?(e(c.activities),c.feedColumns[0]=c.activities):d(c.activities)}),c.activityTime=function(a){var b=new Date,c=b-new Date(a),d=0,e="seconds";return c>31104e6?(d=Math.floor(c/31104e6),e=1===d?"year":"years"):c>2592e6?(d=Math.floor(c/2592e6),e=1===d?"month":"months"):c>864e5?(d=Math.floor(c/864e5),e=1===d?"day":"days"):c>36e5?(d=Math.floor(c/36e5),e=1===d?"hour":"hours"):c>6e4?(d=Math.floor(c/6e4),e=1===d?"minute":"minutes"):(d=Math.floor(c/1e3),e=1===d?"second":"seconds"),d+" "+e+" ago"}}}}]);return b}),function(a,b){"use strict";function c(a,c){function d(a){return this instanceof d?void b.extend(this,a):new d(a)}this.setDefaultOption=function(a){b.extend(d.prototype,a)},a.headerTemplateUrl=c.defaultHeader,this.setDefaultOption(a),this.$get=function(){return d}}var d=b.module("smartTable.column",["smartTable.templateUrlList"]).constant("DefaultColumnConfiguration",{isSortable:!0,isEditable:!1,type:"text",headerTemplateUrl:"",map:"",label:"",sortPredicate:"",formatFunction:"",formatParameter:"",filterPredicate:"",cellTemplate:"",cellTemplateUrl:"",headerClass:"",cellClass:"",saving:!1,width:"",pinnedWidth:0});c.$inject=["DefaultColumnConfiguration","templateUrlList"],d.provider("Column",c),a.ColumnProvider=c}(window,angular),function(a){"use strict";a.module("smartTable.directives",["smartTable.templateUrlList","smartTable.templates","ui.bootstrap.position"]).directive("smartTable",["templateUrlList","DefaultTableConfiguration",function(b,c){return{restrict:"EA",scope:{dataSource:"=rows",columnCollection:"=columns",config:"="},replace:"true",templateUrl:b.smartTable,controller:"SmartTableCtrl",link:function(d,e,f,g){function h(){var e=a.extend({},c,d.config),f=void 0!==d.columns?d.columns.length:0;if(d.filters=[],g.setGlobalConfig(e),"multiple"!==e.selectionMode||e.displaySelectionCheckbox!==!0)for(var h=f-1;h>=0;h--)d.columns[h].isSelectionColumn===!0&&g.removeColumn(h);else g.insertColumn({cellTemplateUrl:b.selectionCheckbox,headerTemplateUrl:b.selectAllCheckbox,isSelectionColumn:!0,isSortable:!1,cellClass:"smart-table-checkbox-cell",headerClass:"smart-table-checkbox-header-cell",pinnedWidth:32},0);a.isDefined(e.manageActions)&&e.editDeleteBtns!==!0&&e.manageBtns!==!0&&g.insertColumn({cellTemplate:"<manage-table-btn></manage-table-btn>",isSortable:!1,cellClass:"smart-table-manage-cell",headerClass:"smart-table-header-manage-cell"},d.columns.length),e.editDeleteBtns===!0&&g.insertColumn({cellTemplate:"<table-edit-delete></table-edit-delete>",isSortable:!1},d.columns.length),a.isDefined(d.config.search)&&d.$watch("config.search",function(a){g.search(a)},!0),e.useServer||d.$watch("dataSource.length",function(a,b){b!==a&&(d.dataCollection=d.dataSource,d.noResults=0===d.dataCollection.length?!0:!1,g.setRowsLength(),g.sortBy())})}if(d.columnCollection)for(var i=0,j=d.columnCollection.length;j>i;i++)g.insertColumn(d.columnCollection[i]);d.config.useServer=a.isDefined(d.dataSource)?!1:!0,d.$watch("filters.length",function(a,b){a!==b&&(d.currentPage=1,g.filterTable())}),h(),g.intialize()}}}]).directive("smartTableDataRow",["$compile","$position","$document",function(b,c,d){return{require:"^smartTable",restrict:"C",link:function(e,f,g,h){var i,j=!1;e.$watch("dataRow.saving",function(g){g?(j=!0,e.position=c.offset(f),i=a.element("<div class=\"table-row-saving\" ng-style=\"{width: position.width + 'px', height: position.height + 'px', left: position.left + 'px', top: position.top + 'px'}\"><div class='row-saving-inner'>Saving</div></div>"),b(i)(e),d.find("body").append(i)):j&&i.remove()});var k;null!=(k=e.config)&&"function"==typeof k.rowFunction&&k.rowFunction(e,f,g,h),f.bind("click",function(){e.$apply(function(){h.toggleSelection(e.dataRow)})})}}}]).directive("smartTableHeaderCell",function(){return{restrict:"C",require:"^smartTable",link:function(a,b,c,d){b.bind("click",function(b){"INPUT"!==b.target.nodeName&&0!==b.target.cellIndex&&a.column.isSortable&&a.$apply(function(){d.sortBy(a.column)})})}}}).directive("smartTableSelectAll",function(){return{restrict:"C",require:"^smartTable",link:function(a,b,c,d){b.bind("click",function(){d.toggleSelectionAll(b[0].checked===!0)})}}}).directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){b.bind(c.stopEvent,function(a){a.stopPropagation()})}}}).directive("smartTableGlobalSearch",["templateUrlList",function(a){return{restrict:"C",require:"^smartTable",scope:{columnSpan:"@"},templateUrl:a.smartTableGlobalSearch,replace:!1,link:function(a,b,c,d){a.searchValue="",a.$watch("searchValue",function(a){""!==a&&d.search(a)})}}}]).directive("tableApplyAction",function(){return{restrict:"C",templateUrl:"../ambassador/templates/table/table.apply-action.html",require:"^smartTable",link:function(a,b,c,d){function e(){var b,c=a.displayedCollection.length,d=[];for(b=0;c>b;b++)a.displayedCollection[b].isSelected&&d.push(a.displayedCollection[b]);return d}a.action=function(a){var b=e();b.length>0&&a(b,function(a){d.toggleSelectionAll(!1),void 0!==a&&("deleteRows"===a?d[a](b):d[a]())})}}}}).directive("displayPerPage",function(){return{restrict:"E",templateUrl:"../ambassador/templates/table/table.display-per-page.html",require:"^smartTable",link:function(b,c,d,e){function f(a){return a.charAt(0).toUpperCase()+a.slice(1)}b.$watch("apiEndpoint",function(){a.isDefined(b.apiEndpoint)&&(b.label=b.paginateLabel||f(b.apiEndpoint))}),b.pageResults=[{text:"10 results",value:10},{text:"25 results",value:25},{text:"50 results",value:50},{text:"100 results",value:100}],b.setDisplayPerPage=function(a){b.itemsByPage=a,b.currentPage=1,b.useServer?e.updateTable():(b.displayedCollection=e.pipe(b.dataCollection),e.setPageDisplay())}}}}).directive("manageTableBtn",function(){return{restrict:"E",templateUrl:"../ambassador/templates/table/table.manage-action-dropdown.html",require:"^smartTable",link:function(a,b,c,d){var e=["Zero Comm.","Approved","Denied"];a.statusText=e[parseInt(a.dataRow.is_approved,10)],a.action=function(b){b(a.dataRow,function(){d.updateTable()})},a.isZero=function(a){return 0===parseFloat(a)}}}}).directive("tableEditDelete",function(){return{restrict:"E",templateUrl:"../ambassador/templates/table/table.manage-action-buttons.html",require:"^smartTable",link:function(a,b,c,d){a.action=function(b){b(a.dataRow,function(b){void 0!==b&&d[b](a.dataRow)})}}}}).directive("tooltipCell",function(){return{restrict:"E",templateUrl:"../ambassador/templates/table/table.tooltip-cell.html",require:"^smartTable",link:function(){}}}).directive("smartTableDataCell",["$filter","$http","$templateCache","$compile","$parse",function(a,b,c,d,e){return{restrict:"C",link:function(f,g){function h(){j.isEditable?(g.html('<div editable-cell="" row="dataRow" column="column" type="column.type"></div>'),d(g.contents())(f)):g.text(f.formatedValue)}var i,j=f.column,k=!j.isEditable,l=f.dataRow,m=a("format"),n=e(j.map);f.$watch("dataRow",function(){f.formatedValue=m(n(l),j.formatFunction,j.formatParameter),k===!0&&g.text(f.formatedValue)},!0),f.$watchCollection("[column.cellTemplate, column.cellTemplateUrl]",function(a,e){e[0]?(k=!1,i=f.$new(),g.html(e[0]),d(g.contents())(i)):e[1]?b.get(e[1],{cache:c}).success(function(a){k=!1,i=f.$new(),g.html(a),d(g.contents())(i)}).error(h):h()})}}}]).directive("inputType",function(){return{restrict:"A",priority:1,link:function(a,b,c){var d=a.$eval(c.type);c.$set("type",d)}}}).directive("editableCell",["templateUrlList","$parse",function(b,c){return{restrict:"EA",require:"^smartTable",templateUrl:b.editableCell,scope:{row:"=",column:"=",type:"="},replace:!0,link:function(b,d,e,f){var g=a.element(d.children()[1]),h=a.element(g.children()[0]),i=c(b.column.map);b.isEditMode=!1,b.$watch("row",function(){b.value=i(b.row)},!0),b.submit=function(){b.myForm.$valid===!0&&(f.updateDataRow(b.row,b.column.map,b.value),f.sortBy()),b.toggleEditMode()},b.toggleEditMode=function(){b.value=i(b.row),b.isEditMode=b.isEditMode!==!0},b.$watch("isEditMode",function(a){a===!0&&(h[0].select(),h[0].focus())
}),h.bind("blur",function(){b.$apply(function(){b.submit()})})}}}])}(angular),function(a){"use strict";a.module("smartTable.filters",[]).constant("DefaultFilters",["currency","date","json","lowercase","number","uppercase"]).filter("format",["$filter","DefaultFilters",function(b,c){return function(d,e,f){var g;return(g=e&&a.isFunction(e)?e:-1!==c.indexOf(e)?b(e):function(a){return a})(d,f)}}])}(angular),function(a){"use strict";a.module("smartTable.table",["smartTable.column","smartTable.utilities","smartTable.directives","smartTable.filters","ui.bootstrap.pagination.smartTable"]).constant("DefaultTableConfiguration",{selectionMode:"none",isGlobalSearchActivated:!1,displaySelectionCheckbox:!1,isPaginationEnabled:!0,isTopPaginationEnabled:!1,itemsByPage:10,maxSize:5,apiEndpoint:"",tableClass:"",defaultParams:{},sortAlgorithm:"",filterAlgorithm:"",tablePinnedCols:0,tablePinnedHeight:0}).controller("SmartTableCtrl",["$scope","$rootScope","Column","$filter","$parse","ArrayUtility","DefaultTableConfiguration","$api","$alert","$timeout",function(b,c,d,e,f,g,h,i,j,k){function l(){var a,c=b.displayedCollection.length;for(a=0;c>a;a++)if(b.displayedCollection[a].isSelected!==!0)return!1;return!0}function m(c,d){var f=(b.sortAlgorithm&&a.isFunction(b.sortAlgorithm))===!0?b.sortAlgorithm:e("orderBy");return d?g.sort(c,f,d.sortPredicate,d.reverse):c}function n(c,d,e,f){var g,h;if(a.isArray(c)&&("multiple"===d||"single"===d)&&e>=0&&e<c.length){if(g=c[e],"single"===d)for(var i=0,j=c.length;j>i;i++)h=c[i].isSelected,c[i].isSelected=!1,h===!0&&b.$emit("selectionChange",{item:c[i]});g.isSelected=f,b.holder.isAllSelected=l(),b.$emit("selectionChange",{item:g})}}function o(a){return a.reverse?"-"+a.sortPredicate:a.sortPredicate}function p(b){var c={};return a.isDefined(b)&&0!==b.length?(b.forEach(function(a){c[a.param]=a.param_val}),c):c}function q(a){b.displayedCollection=a,b.totalRows=a.count,w.calculateNumberOfPages(b.totalRows),w.setPageDisplay()}function r(){w.getData().then(function(a){q(a)})}function s(){for(var a=0,c=b.filters.length;c>a;a++)if(void 0===b.filters[a].filterFunc)return!0;return!1}b.columns=[],b.dataCollection=b.dataSource||[],b.displayedCollection=[],b.numberOfPages=0,b.currentPage=1,b.holder={isAllSelected:!1},b.useServer=!1,b.tableLoader=!1,b.noResults=!1,b.searchActive=!1;var t,u,v={},w=this;b.getPinnedStyle=function(a,c){var d=0,e=1,f={};if("data"===c){for(var g=0;a+1>g;g++)d=b.columns[g].pinnedWidth,e+=b.columns[g].pinnedWidth;a<b.tablePinnedCols&&(f={width:d+"px",left:e-d+"px"}),b.tablePinnedHeight&&(f.height=b.tablePinnedHeight+"px")}else if("header"===c){f={};for(var g=0;a+1>g;g++)d=b.columns[g].pinnedWidth,e+=b.columns[g].pinnedWidth;b.columns[a].width&&(f.width=b.columns[a].width),a<b.tablePinnedCols&&(f={width:d+"px","min-width":d+"px",left:e-d+"px"})}else if("table"===c){for(var h=0,g=0;g<b.tablePinnedCols;g++)h+=b.columns[g].pinnedWidth;f["margin-left"]=h-1}return f},b.getPinnedPadding=function(){for(var a,c=0,d=0;d<b.tablePinnedCols;d++)c+=b.columns[d].pinnedWidth;return a={"padding-left":c+"px"}},b.$on("EXPORT_COLLECTION",function(){b.tableData.displayedCollection=b.displayedCollection}),b.$on("UPDATE_TABLE",function(){w.updateTable()}),this.setRowsLength=function(){b.totalRows=b.dataCollection.length},this.calculateNumberOfPages=function(a){b.numberOfPages=0===a||b.itemsByPage<1?1:Math.ceil(a/b.itemsByPage)},this.setPageDisplay=function(){var a=b.itemsByPage;b.pageStartNumber=(b.currentPage-1)*a+1,b.pageEndNumber=(b.currentPage-1)*a+b.displayedCollection.length},this.setGlobalConfig=function(c){a.extend(b,h,c)},this.changePage=function(c){var d=b.currentPage;a.isNumber(c.page)&&(b.currentPage=c.page,b.useServer?this.getData().then(function(a){q(a)}):(b.displayedCollection=this.pipe(b.dataCollection),b.holder.isAllSelected=l(),this.setPageDisplay(),b.$emit("changePage",{oldValue:d,newValue:b.currentPage})))},this.sortBy=function(a){var c=b.columns.indexOf(a);-1!==c&&a.isSortable===!0&&(t&&t!==a&&(t.reverse="none"),a.sortPredicate=a.sortPredicate||a.map,a.reverse=a.reverse!==!0,t=a),b.useServer?this.getData(a).then(function(a){q(a)}):(b.displayedCollection=this.pipe(b.dataCollection),this.setPageDisplay())},this.sortByNonColumn=function(a){t=a,b.useServer?this.getData(a).then(function(a){q(a)}):(b.displayedCollection=this.pipe(b.dataCollection),this.setPageDisplay())},this.search=function(a,c){b.searchActive&&(c&&-1!==b.columns.indexOf(c)?v[c.map]=a:v={$:a},b.useServer?(void 0!==u&&k.cancel(u),u=k(function(){b.currentPage=1,w.getData().then(function(a){q(a)})},1500)):(b.currentPage=1,b.displayedCollection=this.pipe(b.dataCollection))),b.searchActive=!0},this.pipe=function(c){var d,f=(b.filterAlgorithm&&a.isFunction(b.filterAlgorithm))===!0?b.filterAlgorithm:e("filter");return d=m(g.filter(c,f,v),t),this.calculateNumberOfPages(b.totalRows),b.isPaginationEnabled?g.fromTo(d,(b.currentPage-1)*b.itemsByPage,b.itemsByPage):d},this.updateTable=function(){this.getData().then(function(a){q(a),c.$broadcast("TABLE_UPDATED")})},this.filterTable=function(){var c;b.useServer||s()?r():(c=b.dataCollection,a.forEach(b.filters,function(a){c=c.filter(function(b){return a.filterFunc(b,a)})}),b.totalRows=c.length,b.displayedCollection=this.pipe(c),this.setPageDisplay())},this.getData=function(c){var d,e={},f=p(b.filters),g=void 0===b.config.search||""===b.config.search?{}:{search:b.config.search},h=b.config.displayTopAmbassadorsOrdering?"stat":"ordering";return b.noResults=!1,(b.currentPage-1)*b.itemsByPage>=b.totalRows-b.deletingRows&&(b.currentPage>1&&b.currentPage--,b.deletingRows=0),a.extend(e,b.defaultParams,g,f,{page:b.currentPage,page_size:b.itemsByPage}),void 0!==t?e[h]=o(t):void 0!==c?e[h]=o(c):void 0!==b.startingOrder&&(e[h]=b.startingOrder),b.tableLoader=!0,d=i.all(b.apiEndpoint).getList(e),d.then(function(a){0===a.length&&(b.noResults=!0),b.tableLoader=!1},function(){b.noResults=!0,b.tableLoader=!1}),d},this.intialize=function(){b.tableLoader=!0,b.deletingRows=0;var c={},d=void 0!==b.filters&&0!==b.filters.length?p(b.filters):{},e=b.config.displayTopAmbassadorsOrdering?"stat":"ordering";a.isDefined(b.startingOrder)&&(c[e]=b.startingOrder),b.useServer?(a.extend(c,b.defaultParams,d,{page:1,page_size:b.itemsByPage}),i.all(b.apiEndpoint).getList(c).then(function(a){b.totalRows=a.count,b.totalRows>100&&(b.useServer=!0),0===b.totalRows&&(b.noResults=!0),b.dataCollection=a,b.displayedCollection=w.pipe(a),w.setPageDisplay(),b.tableLoader=!1})):(b.totalRows=b.dataCollection.length,0===b.totalRows&&(b.noResults=!0),this.sortBy(),this.setPageDisplay(),b.tableLoader=!1)},this.insertColumn=function(a,c){var e=new d(a);g.insertAt(b.columns,c,e)},this.removeColumn=function(a){g.removeAt(b.columns,a)},this.moveColumn=function(a,c){g.moveAt(b.columns,a,c)},this.clearColumns=function(){b.columns.length=0},this.toggleSelection=function(a){var c=b.dataCollection.indexOf(a);-1!==c&&n(b.dataCollection,b.selectionMode,c,a.isSelected!==!0)},this.toggleSelectionAll=function(a){var c=0,d=b.displayedCollection.length;if("multiple"===b.selectionMode)for(;d>c;c++)n(b.displayedCollection,b.selectionMode,c,a===!0)},this.removeDataRow=function(a){var c=g.removeAt(b.displayedCollection,a);g.removeAt(b.dataCollection,b.dataCollection.indexOf(c))},this.moveDataRow=function(a,c){g.moveAt(b.displayedCollection,a,c)},this.updateDataRow=function(a,c,d){var e,g=b.displayedCollection.indexOf(a),h=f(c),i=h.assign;-1!==g&&(e=h(b.displayedCollection[g]),e!==d&&(i(b.displayedCollection[g],d),b.$emit("updateDataRow",{item:b.displayedCollection[g]})))},this.deleteRow=function(a){a.remove().then(function(){var c=b.displayedCollection.indexOf(a);w.removeDataRow(c),b.deletingRows=1,w.updateTable()})},this.deleteRows=function(c){var d=c.length;a.forEach(c,function(a){a.remove().then(function(){var e=b.displayedCollection.indexOf(a);w.removeDataRow(e),--d,0===d&&(b.deletingRows=c.length,w.updateTable())})})}}])}(angular),angular.module("smartTable.templates",["partials/defaultCell.html","partials/defaultHeader.html","partials/editableCell.html","partials/globalSearchCell.html","partials/pagination.html","partials/selectAllCheckbox.html","partials/selectionCheckbox.html","partials/smartTable.html"]),angular.module("partials/defaultCell.html",[]).run(["$templateCache",function(a){a.put("partials/defaultCell.html","{{formatedValue}}")}]),angular.module("partials/defaultHeader.html",[]).run(["$templateCache",function(a){a.put("partials/defaultHeader.html",'<span class="header-content" ng-class="{\'sort-ascent\':column.reverse==false,\'sort-descent\':column.reverse==true}" ng-bind-html="column.label"></span>')}]),angular.module("partials/editableCell.html",[]).run(["$templateCache",function(a){a.put("partials/editableCell.html",'<div ng-dblclick="toggleEditMode($event)">\n    <span ng-hide="isEditMode">{{value | format:column.formatFunction:column.formatParameter}}</span>\n\n    <form ng-submit="submit()" ng-show="isEditMode" name="myForm">\n        <input name="myInput" ng-model="value" type="type" input-type/>\n    </form>\n</div>')}]),angular.module("partials/globalSearchCell.html",[]).run(["$templateCache",function(a){a.put("partials/globalSearchCell.html",'<label>Search :</label>\n<input type="text" ng-model="searchValue"/>')}]),angular.module("partials/pagination.html",[]).run(["$templateCache",function(a){a.put("partials/pagination.html",'<ul class="pagination">\n   <li ng-repeat="page in pages" ng-class="{active: page.active, disabled: page.disabled}"><a\n ng-click="selectPage(page.number)">{{page.text}}</a></li>\n</ul>\n')}]),angular.module("partials/selectAllCheckbox.html",[]).run(["$templateCache",function(a){a.put("partials/selectAllCheckbox.html",'<input class="smart-table-select-all"  type="checkbox" ng-model="holder.isAllSelected"/>')}]),angular.module("partials/selectionCheckbox.html",[]).run(["$templateCache",function(a){a.put("partials/selectionCheckbox.html",'<input type="checkbox" ng-model="dataRow.isSelected" stop-event="click"/>')}]),angular.module("partials/smartTable.html",[]).run(["$templateCache",function(a){a.put("partials/smartTable.html",'<div class="container-fluid smart-table-container">    <ga-loader loading="tableLoader"></ga-loader>\n    <div class="row smart-table-header">\n       <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">         <div ng-if="displaySelectionCheckbox" class="table-apply-action-container">\n             <div class="table-apply-action"></div>\n         </div>\n         <div ng-if="config.tableFilters.length > 0" class="table-filter-container">             <table-filters config="config.tableFilters" filters="filters"></table-filters>         </div>       </div>       <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12 pull-right smart-table-search">\n           <input ng-model="config.search" class="form-control" type="text" placeholder="Search">\n       </div>\n       <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 pull-right">\n           <display-per-page></display-per-page>\n       </div>\n    </div>\n    <div class="smart-table-outer-wrapper">\n       <div class="smart-table-wrapper" ng-class="{ \'smart-table-pinned\': tablePinnedCols!==0, \'smart-table-highlights\':displayColumnHighlights===true, \'smart-table-no-results\': noResults }">\n           <table class="smart-table table table-striped {{tableClass}} pinned-{{tablePinnedCols}}" ng-style="getPinnedStyle($index,\'table\')" ng-class="{ pinned: tablePinnedCols!==0 }">\n               <thead>\n                   <tr class="smart-table-global-search-row" ng-if="isGlobalSearchActivated">\n                       <td class="smart-table-global-search" column-span="{{columns.length}}" colspan="{{columnSpan}}">\n                       </td>\n                   </tr>\n                   <tr class="smart-table-header-row">\n                       <th ng-repeat="column in columns" ng-hide="column.nonMonetary && !company.has_non_monetary" ng-include="column.headerTemplateUrl"\n                       class="smart-table-header-cell {{column.headerClass}}" ng-style="getPinnedStyle($index,\'header\')" ng-class="{\'smart-table-disabled-sort\': column.isSortable===false}" scope="col">\n                       </th>\n                   </tr>\n               </thead>\n               <tbody>\n                   <tr ng-repeat="dataRow in displayedCollection" ng-class="{selected:dataRow.isSelected}"\n                   class="smart-table-data-row">\n                       <td ng-repeat="column in columns" class="smart-table-data-cell {{column.cellClass}}" ng-style="getPinnedStyle($index,\'data\')"></td>\n                   </tr>\n                   <tr class="smart-table-no-results-row" ng-if="noResults">\n                       <td class="smart-table-no-results-cell" column-span="{{columnLength}}" colspan="{{columnLength}}">No results found.</td>\n                   </tr>\n               </tbody>\n               <tfoot ng-show="isPaginationEnabled">\n                   <tr class="smart-table-footer-row">\n                   </tr>\n               </tfoot>\n           </table>\n       </div>\n    </div>\n    <div class="smart-table-footer">\n       <div pagination-smart-table="" num-pages="numberOfPages" max-size="maxSize" current-page="currentPage" previous-text="<" next-text=">"></div>\n    </div>\n</div>\n\n\n')}]),function(a){"use strict";a.module("smartTable.templateUrlList",[]).constant("templateUrlList",{smartTable:"partials/smartTable.html",smartTableGlobalSearch:"partials/globalSearchCell.html",editableCell:"partials/editableCell.html",selectionCheckbox:"partials/selectionCheckbox.html",selectAllCheckbox:"partials/selectAllCheckbox.html",defaultHeader:"partials/defaultHeader.html",pagination:"partials/pagination.html"})}(angular),function(a){"use strict";a.module("smartTable.utilities",[]).factory("ArrayUtility",function(){var b=function(a,b){return b>=0&&b<a.length?a.splice(b,1)[0]:void 0},c=function(a,b,c){b>=0&&b<a.length?a.splice(b,0,c):a.push(c)},d=function(a,b,c){var d;b>=0&&b<a.length&&c>=0&&c<a.length&&(d=a.splice(b,1)[0],a.splice(c,0,d))},e=function(b,c,d,e){return c&&a.isFunction(c)?c(b,d,e===!0):b},f=function(b,c,d){return c&&a.isFunction(c)?c(b,d):b},g=function(b,c,d){var e,f,g=[];if(!a.isArray(b))return b;f=Math.max(c,0),f=Math.min(f,b.length-1>0?b.length-1:0),d=Math.max(0,d),e=Math.min(f+d,b.length);for(var h=f;e>h;h++)g.push(b[h]);return g};return{removeAt:b,insertAt:c,moveAt:d,sort:e,filter:f,fromTo:g}})}(angular),function(a){a.module("ui.bootstrap.pagination.smartTable",["smartTable.templateUrlList"]).constant("paginationConfig",{boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"<",nextText:">",lastText:"Last"}).directive("paginationSmartTable",["paginationConfig","templateUrlList",function(b,c){return{restrict:"EA",require:"^smartTable",scope:{numPages:"=",currentPage:"=",maxSize:"="},templateUrl:c.pagination,replace:!0,link:function(c,d,e,f){function g(a,b,c,d){return{number:a,text:b,active:c,disabled:d}}var h=a.isDefined(e.boundaryLinks)?c.$eval(e.boundaryLinks):b.boundaryLinks,i=a.isDefined(e.directionLinks)?c.$eval(e.directionLinks):b.directionLinks,j=a.isDefined(e.firstText)?e.firstText:b.firstText,k=a.isDefined(e.previousText)?e.previousText:b.previousText,l=a.isDefined(e.nextText)?e.nextText:b.nextText,m=a.isDefined(e.lastText)?e.lastText:b.lastText;c.$watch("numPages + currentPage + maxSize",function(){c.pages=[];var a=1,b=c.numPages;c.maxSize&&c.maxSize<c.numPages&&(a=Math.max(c.currentPage-Math.floor(c.maxSize/2),1),b=a+c.maxSize-1,b>c.numPages&&(b=c.numPages,a=b-c.maxSize+1));for(var d=a;b>=d;d++){var e=g(d,d,c.isActive(d),!1);c.pages.push(e)}if(i){var f=g(c.currentPage-1,k,!1,c.noPrevious());c.pages.unshift(f);var n=g(c.currentPage+1,l,!1,c.noNext());c.pages.push(n)}if(h){var o=g(1,j,!1,c.noPrevious());c.pages.unshift(o);var p=g(c.numPages,m,!1,c.noNext());c.pages.push(p)}c.currentPage>c.numPages&&c.selectPage(c.numPages)}),c.noPrevious=function(){return 1===c.currentPage},c.noNext=function(){return c.currentPage===c.numPages},c.isActive=function(a){return c.currentPage===a},c.selectPage=function(a){!c.isActive(a)&&a>0&&a<=c.numPages&&(c.currentPage=a,f.changePage({page:a}))}}}}])}(angular),function(a){a.module("ambassador.table.filters",[]).directive("tableFilters",["$filter","$api",function(){return{restrict:"E",scope:{filters:"=",config:"=",loadTable:"=",filterSetType:"@"},controller:"tableFilterCtrl",templateUrl:"../ambassador/templates/table/table.filter.html",link:function(b,c,d,e){function f(b){this.label=b.label,this.param=b.param,this.param_val=null,this.val_label=b.displayParam,a.isDefined(b.filterFunc)&&(this.filterFunc=b.filterFunc)}function g(a){return a=String(a),1===a.length?"0"+a:a}function h(c){return a.forEach(b.filters,function(a){return a.template===c.template?!0:void 0}),!1}b.selectFilter=function(a){b.selectedFilter=a},b.selectOption=function(a){b.filterValue=a,b.addFilter(b.selectedFilter,b.filterValue)},b.addFilter=function(a,c){var d;""!==b.filterValue&&(c=b.filterValue),""===c||h(a)||(d=new f(a),"calender"===a.template?(d.param_val=g(c),d.val_label=d.param_val):void 0!==a.options?(d.param_val=c.value,d.val_label=c.label):(d.param_val=c,d.val_label=c[d.val_label]),b.filters.push(d),b.selectedFilter="")},b.removeFilter=function(a){b.filters=_.without(b.filters,a)},b.clearAll=function(){b.filters.length=0},b.filterSelected=function(a){if(0===b.filters.length)return a;for(var c=!0,d=0;d<b.filters.length;d++){if(a.param===b.filters[d].param){c=!0;break}c=!1}return c?void 0:a},void 0!==b.config&&e.setConfig(b.config)}}}]).directive("tableFilterInput",["$compile",function(a){return{restrict:"E",require:"^tableFilters",link:function(b,c,d,e){function f(d){c.html(d?"typeahead"===d&&b.async.active?g.typeaheadAsync:g[d]:""),a(c.contents())(b)}var g={text:'<div class="input-group"><input ng-model="filterValue" ng-enter="addFilter(selectedFilter, filterValue)" class="form-control" type="text"><span class="input-group-btn"><button ng-click="addFilter(selectedFilter, filterValue)" class="btn btn-default" type="button"><i class="fa fa-plus"></i></button></span></div>',select:'<div class="dropdown"><a class="dropdown-toggle btn btn-default"> Select an option <i class="fa fa-caret-down"></i></a><ul class="dropdown-menu"><li ng-repeat="o in activeFilter.options"><a ng-click="selectOption(o)">{{o.label}}</a></li></ul></div>',typeahead:'<div><input ng-if="!useDropdown && !useCustomSearch" type="text" ng-model="filterValue" placeholder="Search {{activeFilter.async.endpoint}}" typeahead="o as o[activeFilter.async.field] for o in typeaheadData | filter:{ {{activeFilter.async.field}}: $viewValue} | limitTo:10" typeahead-on-select="addFilter(selectedFilter, filterValue)" typeahead-template-url="../ambassador/templates/table/table.typeahead-filter-template.html" class="form-control"><input ng-if="!useDropdown && useCustomSearch" type="text" ng-model="filterValue" placeholder="Search {{activeFilter.async.endpoint}}" typeahead="o as o[activeFilter.async.field] for o in customSearch($viewValue) | limitTo:10" typeahead-on-select="addFilter(selectedFilter, filterValue)" typeahead-template-url="../ambassador/templates/table/table.typeahead-filter-template.html" class="form-control"><div ng-if="useDropdown" class="dropdown dropdown-select dropdown-form"><a class="dropdown-toggle btn btn-default">Select {{activeFilter.async.endpoint}} <i class="fa fa-caret-down"></i></a><ul class="dropdown-menu pull-right"><li ng-repeat="o in typeaheadData"><a ng-click="addFilter(selectedFilter, o)"><span ng-if="activeFilter.async.displayPrefix !== undefined">{{o[activeFilter.async.displayPrefix]}} - </span>{{o[activeFilter.async.field]}}</a></li></ul></div></div>',typeaheadAsync:'<div class="async-loader"><input type="text" ng-model="filterValue" placeholder="Search {{activeFilter.async.endpoint}}" typeahead="o for o in asyncSearch($viewValue) | filter:{ activeFilter.async.field: $viewValue} | limitTo:15" typeahead-loading="async.loadingResults" typeahead-wait-ms="async.asyncWaitTime" typeahead-template-url="../ambassador/templates/table/table.typeahead-filter-template.html" typeahead-on-select="addFilter(selectedFilter, filterValue)" class="form-control"><i ng-show="async.loadingResults" class="fa fa-refresh fa-spin"></i></div>',calender:'<div class="input-group datepicker-input"><input type="text" class="form-control" ng-change="addFilter(selectedFilter, filterValue)" datepicker-popup="yyyy-MM-dd" ng-model="filterValue" ng-click="open($event)" is-open="opened" close-text="Close" show-weeks="false" show-button-bar="false" /><span class="input-group-btn"><button class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button></span></div>'};b.$watch("selectedFilter",function(a){""===a?(f(),b.filterValue=""):(b.activeFilter=a,void 0!==a.async&&e.getData(a),f(a.template))}),b.$on("update-input",function(){f(b.activeFilter.template)}),b.open=function(a){a.preventDefault(),a.stopPropagation(),b.opened=!0}}}}]).controller("tableFilterCtrl",["$scope","$api","$q",function(b,c,d){var e;b.selectedFilter="",b.filterValue="",b.async={active:!0,loadingResults:!1,asyncWaitTime:500},b.activeFilter={},b.filterOptions=[],this.setConfig=function(c){a.forEach(c,function(a){b.filterOptions.push(a)})},this.getData=function(a){c.all(a.async.endpoint).getList({page_size:50}).then(function(a){a.count<50?(b.async.active=!1,b.useCustomSearch=b.activeFilter.async.additional_field?!0:!1,b.typeaheadData=a):(b.async.active=!0,b.useCustomSearch=!1),b.useDropdown=a.count<25?!0:!1,b.$broadcast("update-input")})},b.asyncSearch=function(a){return e&&e.resolve(),e=d.defer(),b.async.loadingResults=!0,c.all(b.activeFilter.async.endpoint).withHttpConfig({timeout:e.promise}).getList({search:a,ordering:b.activeFilter.async.field}).then(function(a){return b.async.loadingResults=!1,a})},b.customSearch=function(a){for(var c=[],d=0;d<b.typeaheadData.length;d++)(-1!==b.typeaheadData[d][b.activeFilter.async.field].toString().toLowerCase().indexOf(a.toLowerCase())||-1!==b.typeaheadData[d][b.activeFilter.async.additional_field].toString().toLowerCase().indexOf(a.toLowerCase()))&&c.push(b.typeaheadData[d]);return c}}])}(angular);