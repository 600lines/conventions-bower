!function(angular,factory){"use strict";return"function"==typeof define&&define.amd?void define(["angular"],function(angular){return factory(angular)}):factory(angular)}(angular||null,function(angular){"use strict";var app=angular.module("ngAmbassador",["ambassador.constants","ui.bootstrap","angularSpinner","restangular","smartTable.table","ambassador.table.filters","angles","duScroll","angularFileUpload","infinite-scroll","colorpicker.module","ngClipboard"]).config(["ngClipProvider",function(ngClipProvider){ngClipProvider.setPath("bower_components/zeroclipboard/dist/ZeroClipboard.swf")}]).directive("gaSelect",["$api",function($api){return{restrict:"E",scope:{model:"=",data:"=",defaultOption:"=",endpoint:"@",multi:"@",label:"@",placeholder:"@",comparator:"@",resetDisabled:"=",search:"&"},templateUrl:"../ambassador/templates/directive.chooser.html",replace:!1,link:function(scope,element,attrs){scope.dropdown={isEnabled:!1,isOpen:!1},scope.loadingItems=!1,scope.originalPlaceholder=scope.placeholder,scope.$watch("model",function(){scope.showReset="undefined"!=typeof scope.model[scope.label]?!0:!1}),scope.multi!==!0&&scope.model[scope.label]&&(scope.placeholder=scope.model[scope.label]),scope.$watch("data",function(data){data&&data.length<25&&(scope.dropdown.isEnabled=!0)}),scope.removeItem=function(item){var index=scope.model.indexOf(item);scope.model.splice(index,1)},scope.addItem=function(item){scope.multi?(scope.model.push(item),scope.selected=""):(scope.model=item,scope.placeholder=scope.model[scope.label]),scope.dropdown.isOpen=!1},scope.resetField=function(){scope.model={},scope.placeholder=scope.originalPlaceholder},scope.searchFunction=attrs.search?function(val){var results=scope.search({val:val});return results}:function(val){return scope.loadingItems=!0,$api.all(scope.endpoint).getList({search:val}).then(function(data){var results=[];if(scope.model.length>0)for(var i=0;i<data.length;i++){var item=scope.filterChosen(data[i]);item&&results.push(item)}else results=data;return scope.loadingItems=!1,results})},scope.filterChosen=function(item){if(0===scope.model.length)return item;for(var chosen=!0,i=0,l=scope.model.length;l>i;i++)scope.comparator||item!==scope.model[i]?scope.comparator&&item[scope.comparator]===scope.model[i][scope.comparator]&&(chosen=!1):chosen=!1;return chosen?item:!1}}}}]).directive("gaInfiniteScroll",["$api","$diff","$errors","$promiseKeeper","$q",function($api,$diff,$errors,$promiseKeeper,$q){return{restrict:"E",transclude:!0,scope:{endpoint:"@",distance:"@",params:"="},template:'<div id="infinite-container" infinite-scroll="nextPage()" infinite-scroll-disabled="loadingNextPage"></div><div class="infinite-spinner" ng-if="loadingNextPage && (currentPage > 1 || updatingData)" us-spinner="infiniteSpinner"></div><alert-system name="infinite-scroll-alerts" type="page"></alert-system>',link:function(scope,element,attrs,ctrl,transclude){scope.currentPage=1,scope.loadingNextPage=!1,scope.updatingData=!1,scope.items=[],scope.count=0,scope.scollDistance="undefined"!=typeof scope.distance?scope.distance:1,scope.initialGet=!0,scope.infiniteSpinner={radius:5,width:3,length:4,lines:10,color:"#94A4A5"};var abortSearch,initializePromise=$promiseKeeper.add();scope.nextPage=function(){1===scope.currentPage&&initializePromise.deferred.resolve();var queryParams=angular.extend({},scope.params);queryParams.page=scope.currentPage,scope.loadingNextPage||0!==scope.count&&scope.count<=scope.items.length||(scope.loadingNextPage=!0,$api.all(scope.endpoint).getList(queryParams).then(function(data){if(scope.count=data.count,0!==data.count){for(var i=0;i<data.length;i++)scope.items.push(data[i]);scope.currentPage++,queryParams.page=scope.currentPage,scope.loadingNextPage=!1,scope.initialGet=!1}},function(error){0!==error.status&&$errors.output({alertSystem:"infinite-scroll-alerts",alertSystemType:"page",defaultMessage:"Something went wrong while trying to get the data. Please try again or contact support."},error.data)}))},scope.updateData=function(){"undefined"!=typeof abortSearch&&abortSearch.resolve(),abortSearch=$q.defer(),scope.currentPage=1,scope.loadingNextPage=!0,scope.updatingData=!0;var queryParams=angular.extend({},scope.params);queryParams.page=scope.currentPage,$api.all(scope.endpoint).withHttpConfig({timeout:abortSearch.promise}).getList(queryParams).then(function(data){if(scope.items=[],scope.count=data.count,scope.loadingNextPage=!1,scope.updatingData=!1,0!==data.count){for(var i=0;i<data.length;i++)scope.items.push(data[i]);scope.currentPage=2,queryParams.page=scope.currentPage}},function(error){0!==error.status&&$errors.output({alertSystem:"infinite-scroll-alerts",alertSystemType:"page",defaultMessage:"Something went wrong while trying to get the data. Please try again or contact support."},error.data)})},scope.$watch("params",function(newValue,oldValue){$diff.compare(oldValue,newValue)&&scope.updateData()},!0),transclude(scope,function(clone){element.find("div#infinite-container").append(clone)})}}}]).directive("gaButton",function(){return{restrict:"E",transclude:!0,scope:{color:"@",size:"@",loading:"=",buttonDisabled:"=",buttonClick:"&",buttonName:"@",clipboard:"="},template:function(element,attrs){var clipboardString="",clipboardClass="";return attrs.clipboard&&(clipboardString='clip-copy="clipboard"',clipboardClass="btn-clipboard"),'<button class="btn btn-{{color}} {{btnSize}} '+clipboardClass+'" '+clipboardString+' ng-disabled="buttonDisabled || loadingDisabled" ng-click="buttonClick({button: buttonName})"><span ng-class="{ loading: loading }" ng-transclude></span><span ng-show="loading" class="btn-spinner" us-spinner="btnSpinner"></span></button>'},link:function(scope){switch(scope.btnClick=null,scope.loadingDisabled=!1,scope.btnSize="",scope.btnSpinner={},scope.size){case"sm":scope.btnSpinner={radius:4,width:3,length:4,lines:9};break;case"md":scope.btnSpinner={radius:5,width:3,length:4,lines:10};break;case"lg":scope.btnSpinner={radius:9,width:5,length:5,lines:11}}switch(scope.color){case"primary":case"gray":case"danger":scope.btnSpinner.color="#ffffff";break;case"default":scope.btnSpinner.color="#666666"}scope.$watch("loading",function(loading){scope.loadingDisabled=loading?!0:!1}),"md"!==scope.size&&(scope.btnSize="btn-"+scope.size)}}}).directive("gaRedactor",["$script","$api","$timeout","$window","API_URL",function($script,$api,$timeout,$window,API_URL){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModel){scope.redactorLoaded=!1;var editor,updateModel=function(value){$timeout(function(){scope.$apply(function(){ngModel.$setViewValue(value)})})},additionalOptions=attrs.gaRedactor?scope.$eval(attrs.gaRedactor):{},options={changeCallback:updateModel,imageUpload:API_URL+"/misc/images/.json",apiToken:$api.getToken(),premailerEndpoint:API_URL+"/misc/premail/.json",deniedTags:["html","head","title","link","body","meta","script","applet"],plugins:["fontsize","fontcolor","fontfamily","gaimageupload","gaimporttemplate","taglist"],buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","table","link","alignment","horizontalrule"]};angular.extend(options,additionalOptions);var initRedactor=function(){var $_element=$(element);$timeout(function(){editor=$($_element).redactor(options),ngModel.$render()}),ngModel.$render=function(){angular.isDefined(editor)&&$timeout(function(){$($_element).redactor("set",ngModel.$viewValue||""),scope.redactorLoaded=!0})}},redactorPath=additionalOptions.redactorPath?additionalOptions.redactorPath:"bower_components/ambassador-conventions/";$script.load(["//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"]).then(function(){$script.load([redactorPath+"ga-redactor.min.js"]).then(function(){$timeout(function(){initRedactor()})})})}}}]).factory("$validationUtilities",["$q","$api",function($q,$api){return{doesAmbassadorEmailExist:function(value,originalValue){var deferred=$q.defer();return value===originalValue?deferred.resolve():$api.all("ambassadors").getList({email:value}).then(function(data){data.count>=1&&value!==originalValue?deferred.reject("This email address already exists."):deferred.resolve()}),deferred.promise},doesTeamMemberExist:function(value,originalValue){var deferred=$q.defer();return value===originalValue?deferred.resolve():$api.all("team").getList({email:value}).then(function(data){data.count>=1&&value!==originalValue?deferred.reject("Email address is already in use by another user."):deferred.resolve()}),deferred.promise},dropdownItemSelected:function(value){var deferred=$q.defer();return void 0===value?deferred.reject("You must make a selection."):deferred.resolve(),deferred.promise},gaSelectItemSelected:function(value){function isEmptyObject(obj){var key;for(key in obj)return!1;return!0}var deferred=$q.defer();return 0===value.length||isEmptyObject(value)?deferred.reject("You must make a selection."):deferred.resolve(),deferred.promise},isInteger:function(value){var deferred=$q.defer(),integer_regex=/^-?\d+$/;return integer_regex.test(value.trim())?deferred.resolve():deferred.reject("Invalid number.  Please enter a whole number."),deferred.promise},isIntegerOrFloat:function(value){var deferred=$q.defer(),float_regex=/^-?\d+\.?\d+?$/,integer_regex=/^-?\d+$/;return float_regex.test(value.trim())||integer_regex.test(value.trim())?deferred.resolve():deferred.reject("Invalid format.  Please enter a whole or decimal number."),deferred.promise},isLessThanMaxLength:function(value,originalValue,additionalParams){var deferred=$q.defer();return value.length>additionalParams.maxLength?deferred.reject("You may only use up to "+additionalParams.maxLength+" characters."):deferred.resolve(),deferred.promise},isLessThanMaxNumber:function(value,originalValue,additionalParams){var deferred=$q.defer(),dollarValue=parseInt(value,10);return dollarValue>additionalParams.maxNumber?deferred.reject("Number cannot be larger than "+additionalParams.maxNumber+"."):deferred.resolve(),deferred.promise},isNotEmpty:function(value){var deferred=$q.defer();return value.toString().trim().length>0?deferred.resolve():deferred.reject("The field must not be empty."),deferred.promise},isEqualTo:function(value,originalValue,additionalParams){var deferred=$q.defer();return void 0!==additionalParams.comparison&&value.toString()===additionalParams.comparison.toString()?deferred.resolve():deferred.reject("The passwords do not match."),deferred.promise},isRequiredIf:function(value,originalValue,additionalParams){var deferred=$q.defer();return void 0===additionalParams.parentField||0===additionalParams.parentField.toString().length||additionalParams.parentField.toString().length>0&&value.toString().length>0?deferred.resolve():deferred.reject("This field is required."),deferred.promise},isNotFutureDate:function(date){var deferred=$q.defer(),today=new Date,dateInFuture=!1;if(date instanceof Array)for(var i=0;i<date.length;i++){if(new Date(date[i]).setHours(0,0,0,0)>today.setHours(0,0,0,0)){deferred.reject(),dateInFuture=!0;break}i!==date.length-1||dateInFuture||deferred.resolve()}else new Date(date).setHours(0,0,0,0)>today.setHours(0,0,0,0)?deferred.reject():deferred.resolve();return deferred.promise},isValidCreditCard:function(value,originalValue){var deferred=$q.defer();if(value===originalValue)deferred.resolve();else{/[^0-9-\s]+/.test(value.trim())&&deferred.reject("Invalid credit card number.");var nCheck=0,nDigit=0,bEven=!1;value=value.replace(/\D/g,"");for(var n=value.length-1;n>=0;n--){var cDigit=value.charAt(n);nDigit=parseInt(cDigit,10),bEven&&(nDigit*=2)>9&&(nDigit-=9),nCheck+=nDigit,bEven=!bEven}nCheck%10===0?deferred.resolve():deferred.reject("Invalid credit card number.")}return deferred.promise},isValidEmail:function(value){var deferred=$q.defer(),re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(value.trim())?deferred.resolve():deferred.reject("Invalid email address."),deferred.promise},isValidUrl:function(value){var deferred=$q.defer(),re=/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;return re.test(value.trim())?deferred.resolve():deferred.reject('Invalid url.  Please use the format "http(s)://url.com".'),deferred.promise},isValidUrlWithoutProtocol:function(value){var deferred=$q.defer(),re=/^(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;return re.test(value.trim())?deferred.resolve():deferred.reject('Invalid url.  Please use the format "url.com or subdomain.url.com".'),deferred.promise},isZipCode:function(value){var deferred=$q.defer(),re=/^\d{5}([\-]?\d{4})?$/;return re.test(value.trim())?deferred.resolve():deferred.reject("Invalid zip code.  Please follow the XXXXX-XXXX format (with last 4 digits optional)."),deferred.promise},validDollarAmount:function(value){var deferred=$q.defer(),currency_regex=/^-?\d{1,6}\.?\d{1,2}?$/,integer_regex=/^-?\d+$/;return currency_regex.test(value.trim())||integer_regex.test(value.trim())?deferred.resolve():deferred.reject("Invalid format.  Please enter a whole number, or a number in the format 'xx.xx'."),deferred.promise},validEmailOrShortcode:function(value){var deferred=$q.defer(),error_message="",re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,search_object={},key=re.test(value.trim())?"email":"short_code";return search_object[key]=value,error_message="email"===key?"Referring ambassador with this email does not exist.":"Short code does not exist or the email is incomplete.",$api.all("ambassadors").getList(search_object).then(function(data){0===data.count?deferred.reject(error_message):deferred.resolve()},function(){deferred.reject(error_message)}),deferred.promise}}}]).directive("gaFormField",["$q","$timeout","$compile",function($q,$timeout,$compile){return{restrict:"E",replace:!0,scope:{isDisabled:"=?",extraClasses:"@",fieldType:"@?",helpText:"@?",label:"@?",defaultDropdownText:"@?",model:"=?",modelValue:"@",modelText:"@",additionalParams:"=?",selectFunction:"=?",options:"=?",pristine:"=",isRequired:"@?",isRequiredIf:"=?",isRequiredIfField:"=?",monthDropdown:"@?",requiredText:"@?",rules:"=?",equalTo:"=?",stateClasses:"=?",validatedField:"=",validationThreshold:"@?",validationWait:"@?",showPasswordStrength:"@?",placeholder:"@?",showAsterisks:"=",trim:"@?"},link:function(scope,element){function get_template(){var input_template="",disabledString=void 0!==scope.isDisabled?"ng-disabled='disableField'":"",colorpickerString="colorpicker"===scope.fieldType?" colorpicker ":"";input_template="<input ng-trim='{{trimValue}}' ng-model='model' placeholder='{{ placeholder }}' class='form-control' type='text' "+disabledString+colorpickerString+">",input_template+="<span class='help-block'>{{ helpText }}</span><i ng-show=\"state=='working'\" class='fa fa-refresh fa-spin'></i><i ng-show=\"state=='success'\" class='fa fa-check'></i><i ng-show=\"state=='error'\" class='fa fa-exclamation'></i>";var textarea_template="<textarea ng-model='model' class='form-control'></textarea><span class='help-block'>{{ helpText }}</span>",template="<div class='form-group {{ extraClasses }}'>  <label ng-if='label'>"+scope.label+"<span ng-if='showAsterisks!==false'>{{labelSuffix}}</span></label>  <div class='async-loader'>",select_template="";if(scope.options){if(scope.dropdown={isOpen:!1},"simple-select"===scope.fieldType){var model_value=scope.modelValue?scope.modelValue:"value",model_text=scope.modelText?scope.modelText:"text";select_template='<div class="dropdown dropdown-select dropdown-form"><a class="dropdown-toggle btn btn-default"><span ng-if="monthDropdown && model">{{model.'+model_value+"}} - </span>{{model."+model_text+'}} <span class="caret"></span></a><ul class="dropdown-menu"><li ng-repeat="o in options"><a ng-click="selectOption(o)"><span ng-if="monthDropdown">{{o.'+model_value+"}} - </span>{{o."+model_text+"}}</a></li></ul></div>"}else select_template='<div class="dropdown dropdown-select dropdown-form" is-open="dropdown.isOpen"><a class="dropdown-toggle btn btn-default">{{modelLabel || defaultDropdownText || "Select one"}} <span class="caret"></span></a><ul class="dropdown-menu"><li ng-repeat="o in options"><a ng-click="selectItem(o)">{{o.name}}</a></li></ul></div>';select_template+="<span class='help-block'>{{ helpText }}</span>"}var checkbox_template='<div class="form-group checkbox-group no-label {{ extraClasses }}"><div class="input-group"><span class="input-group-addon"><input ng-model="model" id="'+scope.$id+'" type="checkbox"></span><label class="form-control" for="'+scope.$id+'">'+scope.label+'<span ng-if="showAsterisks!==false">{{labelSuffix}}</span></label></div></div>',password_template='<input ng-model="model" class="form-control" type="password" placeholder="{{ placeholder }}"><span class="help-block">{{ helpText }}</span>';"true"===scope.showPasswordStrength&&(password_template+='<span ga-password-strength="model" id="password-strength" class="label label-input"></span>');var password_conf_template='<input ng-model="model" class="form-control" type="password" placeholder="{{ placeholder }}"><span class="help-block">{{ helpText }}</span><i ng-show="state==\'working\'" class="fa fa-refresh fa-spin"></i><i ng-show="state==\'success\'" class="fa fa-check"></i><i ng-show="state==\'error\'" class="fa fa-exclamation"></i>';return"textarea"===scope.fieldType?template+=textarea_template:"select"===scope.fieldType||"simple-select"===scope.fieldType?template+=select_template:"ga-select"===scope.fieldType?template+='<ga-select model="model" endpoint="{{additionalParams.config.endpoint}}" comparator="{{additionalParams.config.comparator}}" data="additionalParams.config.data" multi="{{additionalParams.config.multi}}" placeholder="{{additionalParams.config.placeholder}}" label="{{additionalParams.config.label}}"></ga-select><span class="help-block">{{ helpText }}</span>':"password"===scope.fieldType?template+=password_template:"checkbox"===scope.fieldType?template=checkbox_template:"password-conf"===scope.fieldType?(scope.$watch("equalTo",function(value){scope.additionalParams={comparison:scope.equalTo},value&&scope.model&&(scope.model="",validate("change"))}),template+=password_conf_template):template+=input_template,void 0!==scope.isRequiredIf&&scope.$watch("isRequiredIfField",function(value){if(value)scope.labelSuffix="*",scope.validatedField=!1,required=!0;else{scope.labelSuffix="",scope.validatedField=!0,required=!1;for(var key in scope.stateClasses)element.removeClass(scope.stateClasses[key]),labelElement.removeClass(scope.stateClasses[key]);scope.state="",scope.helpText=void 0===originalHelpText?"":originalHelpText}scope.additionalParams={parentField:value}}),"checkbox"!==scope.fieldType&&(template+="  </div></div>"),template}function getTypeLabel(type){angular.forEach(scope.options,function(commissionType){type===commissionType.value&&(scope.modelLabel=commissionType.name)}),angular.isUndefined(scope.modelLabel)&&(scope.modelLabel="Select referral type")}function get_field_type(){return element.find("password"===scope.fieldType||"password-conf"===scope.fieldType?"input":"simple-select"===scope.fieldType?"select":scope.fieldType)}function bind_events(){("select"===scope.fieldType||"simple-select"===scope.fieldType)&&inputElement.bind("change",validate),"ga-select"!==scope.fieldType&&(inputElement.bind("blur keyup",function(evt){if(timer&&$timeout.cancel(timer),"blur"===evt.type)validate(evt);else if(9!==evt.keyCode){var validationWait=1500;void 0!==scope.validationWait&&(validationWait=parseInt(scope.validationWait,10)),timer=$timeout(function(){(""!==inputElement[0].value||required===!0)&&validate(evt)},validationWait)}}),inputElement.bind("focus",function(){fieldPristine&&(originalValue=angular.copy(scope.model),fieldPristine=!1)}))}function handle_error(error){$timeout(function(){scope.state="error",scope.helpText=void 0!==scope.additionalParams&&void 0!==scope.additionalParams.errorMessage?scope.additionalParams.errorMessage:error,scope.validatedField=!1,element.addClass(scope.stateClasses.error),labelElement.addClass(scope.stateClasses.error)})}function initialize(){if(void 0===scope.stateClasses)scope.stateClasses=defaultStateClasses;else for(var key in defaultStateClasses)scope.stateClasses.hasOwnProperty(key)||(scope.stateClasses[key]=defaultStateClasses[key]);scope.validationThreshold=void 0===scope.validationThreshold?1:parseInt(scope.validationThreshold,10),required="true"===scope.isRequired?!0:!1}function success(){scope.state="success",scope.helpText=originalHelpText,element.removeClass(scope.stateClasses.error),scope.validatedField=!0,element.addClass(scope.stateClasses.success),labelElement.removeClass(scope.stateClasses.error)}function validate(evt){var value=null,result=null,first=!0;if("select"===scope.fieldType)value=scope.model;else if("simple-select"===scope.fieldType)value=""===scope.model?"":scope.model.text;else if("ga-select"===scope.fieldType)value=scope.model;else if(void 0!==evt.target)try{value=evt.srcElement.value}catch(e){value=evt.target.value}else value=scope.model;if(scope.validatedField=!0,scope.pristine=!1,required===!0&&angular.isDefined(value)&&(""===value||"function"==typeof value.trim&&0===value.trim().length||value===!1))handle_error(scope.isRequiredText?scope.isRequiredText:"This field is required.");else if(""!==value&&scope.rules.length>0)scope.state="working",("change"===evt.type||"blur"===evt.type||void 0!==value&&value.toString().length>=scope.validationThreshold||void 0!==value)&&(angular.forEach(scope.rules,function(validation_function){first?(result=validation_function(value,originalValue,scope.additionalParams),first=!1):result=result.then(function(){return validation_function(value,originalValue,scope.additionalParams)})}),scope.rules.length>0&&result.then(success,handle_error));else{for(var key in scope.stateClasses)element.removeClass(scope.stateClasses[key]),labelElement.removeClass(scope.stateClasses[key]);scope.state="",scope.helpText=void 0===originalHelpText?"":originalHelpText,scope.validatedField=!0,scope.$$phase||"checkbox"===scope.fieldType||scope.$apply()}}scope.disableField=!1,scope.$watch("isDisabled",function(){scope.disableField=scope.isDisabled}),scope.trimValue="true"===scope.trim?!1:!0,scope.selectItem=function(item){scope.modelLabel=item.name,scope.model=item.value,scope.dropdown.isOpen=!1,validate("change")},scope.selectOption=function(option){scope.model=option,validate("change")},scope.$watch("model",function(newValue,oldValue){"true"===scope.trim&&void 0!==newValue&&(scope.model=newValue.trim()),void 0!==scope.additionalParams&&scope.additionalParams.config&&newValue!==oldValue&&validate("change"),"checkbox"===scope.fieldType&&newValue!==oldValue&&validate("change"),angular.isDefined(scope.model)&&"select"===scope.fieldType&&getTypeLabel(scope.model)},!0),void 0===scope.fieldType&&(scope.fieldType="input"),"true"===scope.isRequired&&(scope.labelSuffix="*"),element.html(get_template()),$compile(element.contents())(scope);var defaultStateClasses={error:"has-error",success:"has-success",working:"working"},fieldPristine=!0,inputElement=get_field_type(),labelElement=element.find("label"),originalHelpText=scope.helpText,originalValue=fieldPristine&&null!==scope.model?angular.copy(scope.model):"",required=null,timer=null;initialize(),bind_events()}}}]).directive("gaPasswordStrength",[function(){return{replace:!1,restrict:"A",scope:{gaPasswordStrength:"="},link:function(scope,elem){var strength={text:["Weak","Acceptable","Strong","Very Strong"],classes:["danger","warning","primary","success"],mesureStrength:function(p){for(var _force=0,_regex=/[$-/:-?{-~!""^_`\[\]]/g,_lowerLetters=/[a-z]+/.test(p),_upperLetters=/[A-Z]+/.test(p),_numbers=/[0-9]+/.test(p),_symbols=_regex.test(p),_flags=[_lowerLetters,_upperLetters,_numbers,_symbols],_passedMatches=0,i=0;i<_flags.length;i++)_flags[i]===!0&&_passedMatches++;return _force+=2*p.length+(p.length>=10?1:0),_force+=10*_passedMatches,_force=p.length<=6?Math.min(_force,10):_force,_force=1===_passedMatches?Math.min(_force,10):_force,_force=2===_passedMatches?Math.min(_force,20):_force,_force=3===_passedMatches?Math.min(_force,40):_force},getColor:function(s){var idx=0;return idx=10>=s?0:20>=s?1:40>=s?2:3,{idx:idx+1,text:this.text[idx],color_class:this.classes[idx]}}};scope.$watch("gaPasswordStrength",function(){if(""===scope.gaPasswordStrength||"undefined"==typeof scope.gaPasswordStrength)elem.css({display:"none"});else{var c=strength.getColor(strength.mesureStrength(scope.gaPasswordStrength));elem.css({display:"inline"}),elem.removeClass("label-danger").removeClass("label-warning").removeClass("label-info").removeClass("label-primary").removeClass("label-success").removeClass("label-warning").addClass("label label-"+c.color_class).text(c.text)}})}}}]).factory("$alertMap",function(){return{createNew:function(){var stack={app:null,page:null,form:null};return{getSystem:function(type,name){if(null===stack[type])return stack[type]={},!1;for(var key in stack[type])if(key===name)return stack[type][key];return!1},createSystem:function(type,name,update){return void 0===update&&(update=null),stack[type][name]={update:update,alerts:[]},stack[type][name]},registerUpdate:function(type,name,update){return stack[type][name].update=update,stack[type][name]},removeSystem:function(type,name){delete stack[type][name]},addAlert:function(type,name,alert){stack[type][name].alerts.push(alert)},removeAlert:function(type,name,index){var system=this.getSystem(type,name);return system.alerts.splice(index,1)},getIndex:function(alert){return stack[alert.type][alert.name].alerts.indexOf(alert)}}}}}).factory("$alertStack",["$document","$compile","$timeout","$alertMap",function($document,$compile,$timeout,$alertMap){function startTimer(options){$timeout(function(){$alertStack.close(options)},options.timerVal)}function addSystemToDom(options){var body=$document.find("body").eq(0),angularDomEl=angular.element("<alert-system></alert-system>");angularDomEl.attr("type",options.type),angularDomEl.attr("name",options.name),angularDomEl.addClass("page");var alertSystemEl=$compile(angularDomEl)(options.scope);body.append(alertSystemEl)}function addAlert(system,options){activeAlerts.addAlert(options.type,options.name,options),options.timer&&startTimer(options),null!==system.update&&system.update(system.alerts)}var activeAlerts=$alertMap.createNew(),$alertStack={};return $alertStack.getAlerts=function(type,name){var system=activeAlerts.getSystem(type,name);return system.alerts},$alertStack.registerSystem=function(type,name,update){var system=activeAlerts.getSystem(type,name);return system&&null!==system.update?update(system.alerts):system&&null===system.update?(system=activeAlerts.registerUpdate(type,name,update),update(system.alerts)):(system=activeAlerts.createSystem(type,name,update),void 0!==update&&update(system.alerts)),system},$alertStack.deleteSystem=function(type,name){activeAlerts.removeSystem(type,name)},$alertStack.add=function(options,checked){var waitToLoad,system=activeAlerts.getSystem(options.type,options.name);!system&&options.register?(system=$alertStack.registerSystem(options.type,options.name),addAlert(system,options)):system||options.register||void 0!==checked?system||options.register||!checked?addAlert(system,options):(addSystemToDom(options),waitToLoad=setInterval(function(){system=activeAlerts.getSystem(options.type,options.name),system&&(clearInterval(waitToLoad),addAlert(system,options))},500)):$timeout(function(){$alertStack.add(options,!0)},500),options.scroll&&$document.scrollTo(0,0,500)},$alertStack.close=function(alert,index){void 0===index&&(index=activeAlerts.getIndex(alert)),activeAlerts.removeAlert(alert.type,alert.name,index),null!==alert.callback&&alert.callback()},$alertStack}]).provider("$alert",function(){var $alertProvider={options:{style:"info",type:"page",name:void 0,register:!1,text:"",timer:!0,timerVal:4e3,callback:null,scroll:!0},$get:["$rootScope","$alertStack",function($rootScope,$alertStack){var $alert={};return $alert.add=function(alertOptions){alertOptions=angular.extend({},$alertProvider.options,alertOptions);var alertScope=(alertOptions.scope||$rootScope).$new();$alertStack.add({scope:alertScope,style:alertOptions.style,type:alertOptions.type,name:alertOptions.name,register:alertOptions.register,text:alertOptions.text,timer:alertOptions.timer,timerVal:alertOptions.timerVal,callback:alertOptions.callback,scroll:alertOptions.scroll})},$alert.clearAll=function(type,alertSystem){var alerts=$alertStack.getAlerts(type,alertSystem),alertsToClose=[];angular.forEach(alerts,function(alert){alertsToClose.push(alert)}),angular.forEach(alertsToClose,function(alert){$alertStack.close(alert)})},$alert}]};return $alertProvider}).directive("alertSystem",["$alertStack","$timeout",function($alertStack,$timeout){return{restrict:"EA",template:'<div class="alert-system-inner"><alert ng-repeat="alert in alerts" type="{{alert.style}}" close="closeAlert(alert, $index)">{{alert.text}}</alert></div>',scope:{type:"@",name:"@"},link:function(scope,elm){var type=angular.isDefined(scope.type)?scope.type:"page",name=angular.isDefined(scope.name)?scope.name:null,update=function(alerts){$timeout(function(){scope.alerts=alerts})};$alertStack.registerSystem(type,name,update),elm.addClass("alert-system"),"page"===type?elm.addClass("page"):"app"===type&&elm.addClass("app"),scope.closeAlert=function(alert,index){$alertStack.close(alert,index)},scope.$on("$destroy",function(){var alerts=$alertStack.getAlerts(type,name);0===alerts.length&&$alertStack.deleteSystem(type,name)})}}}]).directive("gaLineChart",[function(){return{restrict:"E",templateUrl:"../ambassador/templates/charts/line-chart.html",replace:!1,scope:{config:"=",height:"@",width:"@"},link:function(scope){var initChart=function(){scope.chartHeight=scope.height?scope.height:"150",scope.chartWidth=scope.width?scope.width:"300",scope.chart={},scope.options={},scope.chart.labels=scope.config.labels,scope.chart.datasets=[];
for(var i=0;i<scope.config.datasets.length;i++){var dataset={active:!0,label:scope.config.datasets[i].label,fillColor:"rgba(255,255,255,0)",strokeColor:scope.config.datasets[i].color,pointColor:scope.config.datasets[i].color,pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:scope.config.datasets[i].color,data:scope.config.datasets[i].data};scope.chart.datasets.push(dataset)}scope.chartCopy=JSON.parse(JSON.stringify(scope.chart))};scope.$watch("config",function(){initChart()}),scope.toggleDataset=function(index){scope.chartCopy.datasets[index].active=scope.chartCopy.datasets[index].active?!1:!0;for(var updatedDataset=[],activeCount=0,i=0;i<scope.chartCopy.datasets.length;i++)scope.chartCopy.datasets[i].active===!0&&(updatedDataset.push(scope.chartCopy.datasets[i]),activeCount++);activeCount>0?scope.chart.datasets=JSON.parse(JSON.stringify(updatedDataset)):scope.chartCopy.datasets[index].active=scope.chartCopy.datasets[index].active?!1:!0}}}}]).directive("gaDoughnutChart",["$helper",function($helper){return{restrict:"E",templateUrl:"../ambassador/templates/charts/doughnut-chart.html",replace:!1,scope:{config:"=",responsive:"="},link:function(scope){var initChart=function(){scope.chartData=[],scope.chartDataCopy=[],scope.chartLeftLabels=[],scope.chartRightLabels=[],scope.chartResponsive=void 0===scope.responsive?!0:scope.responsive,scope.options={};for(var chartTotal=$helper.sum(scope.config.datasets,"value"),i=0;i<scope.config.datasets.length;i++){var dataset={active:!0,label:scope.config.datasets[i].label,iconClass:scope.config.datasets[i].iconClass,highlight:$helper.colorLuminance(scope.config.datasets[i].color,.1),color:scope.config.datasets[i].color,value:scope.config.datasets[i].value,percent:Math.round(scope.config.datasets[i].value/chartTotal*100),id:i};scope.chartData.push(dataset),i<Math.ceil(scope.config.datasets.length/2)&&scope.chartLeftLabels.push(dataset),i>=Math.ceil(scope.config.datasets.length/2)&&scope.chartRightLabels.push(dataset)}scope.chartDataCopy=JSON.parse(JSON.stringify(scope.chartData))};scope.$watch("config",function(){initChart()}),scope.toggleDataset=function(index){scope.chartDataCopy[index].active=scope.chartDataCopy[index].active?!1:!0;for(var updatedDataset=[],activeCount=0,i=0;i<scope.chartDataCopy.length;i++)scope.chartDataCopy[i].active===!0&&(updatedDataset.push(scope.chartDataCopy[i]),activeCount++);activeCount>0?scope.chartData=JSON.parse(JSON.stringify(updatedDataset)):scope.chartDataCopy[index].active=scope.chartDataCopy[index].active?!1:!0},scope.checkActive=function(index){return scope.chartDataCopy[index].active}}}}]).directive("gaLoader",[function(){return{restrict:"E",replace:!0,template:'<div ng-class="{\'fade-in\':loading===true, \'fade-out\':loading===false }" class="ga-loader"><div class="ga-spinner"><span class="loader-text">Loading</span><svg class="spinner" width="100px" height="100px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg"><circle class="path" fill="none" stroke-width="5" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div>',scope:{loading:"="},link:function(){}}}]).directive("gaStatBoxOne",[function(){return{restrict:"E",replace:!0,templateUrl:"../ambassador/templates/stats/stats.box-1.html",scope:{boxes:"=",autoWidth:"="},link:function(scope){scope.styles={},scope.getStyles=function(){return scope.autoWidth===!0&&(scope.styles.width=100/scope.boxes.length+"%"),scope.styles}}}}]).directive("gaStatBoxTwo",[function(){return{restrict:"E",replace:!0,templateUrl:"../ambassador/templates/stats/stats.box-2.html",scope:{boxes:"=",autoWidth:"="},link:function(scope){scope.styles={},scope.getStyles=function(){return scope.autoWidth===!0&&(scope.styles.width=100/scope.boxes.length+"%"),scope.styles}}}}]).directive("gaStatBoxThree",[function(){return{restrict:"E",replace:!0,templateUrl:"../ambassador/templates/stats/stats.box-3.html",scope:{boxes:"=",autoWidth:"="},link:function(scope){scope.styles={},scope.getStyles=function(){return scope.autoWidth===!0&&(scope.styles.width=100/scope.boxes.length+"%"),scope.styles}}}}]).directive("gaValueTemplate",["$compile",function($compile){return{restrict:"E",scope:{value:"=",responsive:"=",compression:"=",min:"=",max:"=",scopeLevel:"@"},replace:!0,template:"<div ng-style='{fontSize:fontSize}'></div>",link:function(scope,element,attrs){element.html(scope.value),void 0===scope.scopeLevel&&(scope.scopeLevel=3);for(var valueScope=scope,i=1;i<=scope.scopeLevel;i++)valueScope=valueScope.$parent;$compile(element.contents())(valueScope),scope.compressor=attrs.compression||1,scope.minFontSize=attrs.min||Number.NEGATIVE_INFINITY,scope.maxFontSize=attrs.max||Number.POSITIVE_INFINITY,scope.elementWidth=element[0].offsetWidth,scope.resizer=function(){scope.elementWidth=element[0].offsetWidth,scope.fontSize=Math.max(Math.min(scope.elementWidth/(10*scope.compressor),parseFloat(scope.maxFontSize)),parseFloat(scope.minFontSize))+"px"},scope.responsive&&(scope.resizer(),scope.$watch("value",function(){scope.resizer()}),angular.element(window).bind("resize",function(){scope.$apply(scope.resizer)}),scope.$watch(function(){return element.width()},function(){scope.resizer()}))}}}]).factory("$helper",function(){return{colorLuminance:function(hex,lum){hex=String(hex).replace(/[^0-9a-f]/gi,""),hex.length<6&&(hex=hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2]),lum=lum||0;var c,i,rgb="#";for(i=0;3>i;i++)c=parseInt(hex.substr(2*i,2),16),c=Math.round(Math.min(Math.max(0,c+c*lum),255)).toString(16),rgb+=("00"+c).substr(c.length);return rgb},sum:function(obj,key){for(var sum=0,i=0;i<obj.length;i++)sum+=parseFloat(obj[i][key]);return sum}}}).factory("$errors",["$alert",function($alert){return{output:function(options,error){var errorAlerts=[],fieldError=!1;if(error&&"object"==typeof error){for(var key in error)"detail"===key?errorAlerts.push(error[key]):"non_field_errors"===key?errorAlerts.push(error[key][0]):fieldError=!0;fieldError===!0&&errorAlerts.push("Please ensure all required fields are properly completed.")}else errorAlerts.push(angular.isDefined(options.defaultMessage)?options.defaultMessage:"Something went wrong. Please try again or contact support.");for(var i=0;i<errorAlerts.length;i++)if(2>i){var alertConfig={type:options.alertSystemType?options.alertSystemType:"page",name:options.alertSystem,scroll:void 0===options.alertScroll||options.alertScroll===!0?!0:!1,timer:void 0===options.alertTimer||options.alertScroll===!0?!0:!1,register:!0,style:"danger",text:errorAlerts[i]};"page"===alertConfig.type&&(alertConfig.register=!1),$alert.add(alertConfig)}}}}]).factory("$promiseKeeper",["$q","$timeout",function($q,$timeout){var $promiseKeeper={},promises=[],promiseData=[],keeperStartTime=null,keeperConfig={expect:0,timeout:30,success:function(){},loading:function(){}},promiseConfig={id:"promise",status:"new"},_startPromising=function(){"function"==typeof keeperConfig.loading&&keeperConfig.loading();var promiseCount=promises.length;$q.all(promises).finally(function(){"function"==typeof keeperConfig.success&&promises.length===promiseCount&&(keeperConfig.success(),_resetPromises())})},_resetPromises=function(){promises=[],promiseData=[],keeperStartTime=null};return $promiseKeeper.getActive=function(){return promiseData.length>0?promiseData:!1},$promiseKeeper.config=function(config){keeperConfig=angular.extend(keeperConfig,config)},$promiseKeeper.add=function(config){var deferred=$q.defer(),promiseConf=angular.extend(angular.copy(promiseConfig),config);promiseConf.promise=deferred.promise,promiseConf.deferred=deferred,promiseConf.status="loading",promiseConf.id="promise"+(parseInt(promises.length)+1),promiseConf.start=(new Date).getTime(),promiseData.push(promiseConf),promises.push(deferred.promise),null===keeperStartTime&&(keeperStartTime=(new Date).getTime());var promiseTimeout=$timeout(function(){promiseConf.status="timeout",promiseConf.deferred.reject(promiseConf)},1e3*parseInt(keeperConfig.timeout)-(promiseConf.start-keeperStartTime));return promiseConf.promise.then(function(){$timeout.cancel(promiseTimeout),promiseConf.status="success"}),_startPromising(),promiseConf},$promiseKeeper}]).factory("$file",["$upload","$api",function($upload,$api){var $file={};return $file.download=function(url){var hiddenIFrameID="ga-download",iframe=document.getElementById(hiddenIFrameID);null===iframe&&(iframe=document.createElement("iframe"),iframe.id=hiddenIFrameID,iframe.style.display="none",document.body.appendChild(iframe)),iframe.src=url},$file.upload=function(config){return config.headers={Authorization:"Token "+$api.getToken()},$upload.upload(config)},$file}]).factory("$gaModal",["$modal","$injector",function($modal,$injector){var $gaModal={};return $gaModal.open=function(config){var modalInstance;return config.controller=["$scope","$modalInstance",function($scope,$modalInstance){$scope.title=config.title,$scope.buttons=config.buttons,$scope.close=function(){$modalInstance.dismiss("cancel")};for(var property in config.resolve)$scope[property]=$injector.invoke(config.resolve[property])}],"undefined"!=typeof config.templateUrl&&(config.template='<ga-modal-template title="title" close="close()" buttons="buttons"><div ng-include="\''+config.templateUrl+"'\"></div></ga-modal-template>",delete config.templateUrl),modalInstance=$modal.open(config)},$gaModal}]).directive("gaModalTemplate",[function(){return{restrict:"E",transclude:!0,scope:{title:"=",buttons:"=",close:"&"},templateUrl:"../ambassador/templates/modal.html",link:function(){}}}]).factory("$script",["$q",function($q){var $script={};return $script.load=function(urls){var promises=[];return angular.forEach(urls,function(url){var scriptPromise=$q.defer();promises.push(scriptPromise.promise);var head=document.getElementsByTagName("head")[0],script=document.createElement("script");script.type="text/javascript",script.src=url,head.appendChild(script),script.addEventListener?script.addEventListener("load",function(){scriptPromise.resolve()},!1):script.onreadystatechange=function(){"loaded"===script.readyState&&scriptPromise.resolve()}}),$q.all(promises)},$script}]).factory("$diff",[function(){var $diff={};return $diff.compare=function(original,toCompare,emptyStringIsNotNull){var diffObj,objectDiff={};return objectDiff.diff=function diff(a,b){if(a===b)return!1;var toSave={},equal=!0;for(var key in a)if(a[key]!==b[key]){if(!emptyStringIsNotNull&&(null===a[key]&&""===b[key]||""===a[key]&&null===b[key]))continue;var typeA=typeof a[key],typeB=typeof b[key];if("object"!==typeA||"object"!==typeB||_.isArray(a[key])||_.isArray(b[key]))"function"===typeA||"function"===typeB||_.isArray(a[key])||_.isArray(b[key])||(equal=!1,toSave[key]=b[key]);else{var valueDiff=diff(a[key],b[key]);valueDiff!==!1&&(equal=!1,toSave[key]=valueDiff)}}return equal?!1:toSave},diffObj=objectDiff.diff(original,toCompare)},$diff}]).factory("$api",["Restangular","API_URL",function(Restangular,API_URL){var token,$api=Restangular.withConfig(function(RestangularConfigurer){RestangularConfigurer.setBaseUrl(API_URL),RestangularConfigurer.setRequestSuffix("/"),token&&RestangularConfigurer.setDefaultHeaders({Authorization:"Token "+token}),RestangularConfigurer.setRestangularFields({id:"uid"}),RestangularConfigurer.setResponseExtractor(function(response,operation){var newResponse;return"getList"===operation?angular.isDefined(response.count)?(newResponse=response.results,newResponse.count=response.count,newResponse.next=response.next,newResponse.previous=response.previous):(newResponse=response,newResponse.count=_.size(response)):newResponse=response,newResponse})});return $api.setToken=function(tokenToSet){token=tokenToSet,$api.setDefaultHeaders({Authorization:"Token "+token})},$api.getToken=function(){return token},$api}]).directive("gaCurrency",["$filter",function($filter){return{restrict:"E",replace:!0,scope:{type:"=",amount:"=",pointsLabel:"=",currency:"=",typesConfig:"="},template:"<div>{{displayAmount}}</div>",link:function(scope){var currencies={USD:"$",GBP:"£",SGD:"$",EUR:"€",AUD:"$",ZAR:"R",BRL:"R$",CAD:"$"},updateAmount=function(){var filter=$filter("currency"),amountTest=parseFloat(scope.amount);scope.displayAmount=angular.isDefined(scope.type)&&angular.isDefined(scope.typesConfig)&&-1!==scope.typesConfig.nonMonetary.indexOf(scope.type)?scope.amount+" "+scope.pointsLabel:filter(amountTest,currencies[scope.currency],2)};scope.$watch("amount",function(){updateAmount()})}}}]).directive("gaAvatar",["$filter",function(){return{restrict:"E",scope:{image:"=",alt:"@"},template:"<div class='ga-avatar'><img ng-src='{{image}}' ng-class='{ \"fade-in\": avatarLoaded===true }' ></div>",link:function(scope,element){element.find("img").bind("load",function(){scope.avatarLoaded=!0,scope.$$phase||scope.$apply()})}}}]).directive("gaActivityFeed",["$api","$timeout","$promiseKeeper",function($api,$timeout,$promiseKeeper){return{restrict:"E",scope:{endpoint:"@",numberOfItems:"@",columns:"@",feedTitle:"@",companyCurrency:"@",companyPoints:"@",ambassadorTemplate:"=",config:"=",filters:"="},templateUrl:"../ambassador/templates/activity-feed.html",link:function(scope){function loadActivity(){scope.activities=[],scope.feedColumns=[];var requestData=void 0!==scope.filters?angular.copy(scope.filters):{};requestData.page_size=scope.numberOfItems;var loadingPromise=$promiseKeeper.add();$api.all(scope.endpoint).getList(requestData).then(function(data){loadingPromise.deferred.resolve(),scope.activities=data,1==scope.columns?(getOrientation(scope.activities),scope.feedColumns[0]=scope.activities):(itemsPerColumn=Math.ceil(data.length/scope.columns),splitIntoColumns(scope.activities))})}function splitIntoColumns(data){for(var i=0;i<scope.columns;i++)scope.feedColumns.push([]),angular.forEach(data,function(activity,index){index>=itemsPerColumn*i&&itemsPerColumn*(i+1)>index&&(activity.orientation="right",scope.feedColumns[i].push(activity))})}function getOrientation(data){angular.forEach(data,function(activity,index){activity.orientation=0===index?"left":activity.type!==data[index-1].type?"left"===data[index-1].orientation?"right":"left":data[index-1].orientation})}var itemsPerColumn=Math.ceil(scope.numberOfItems/scope.columns),initialized=!1;scope.$watch("filters",function(newValue,oldValue){(newValue!==oldValue||initialized===!1)&&(loadActivity(),initialized=!0)},!0),scope.activityTime=function(dateTime){var currentDateTime=new Date,diff=currentDateTime-new Date(dateTime),readableDiff=0,timeUnit="seconds";return diff>31104e6?(readableDiff=Math.floor(diff/31104e6),timeUnit=1===readableDiff?"year":"years"):diff>2592e6?(readableDiff=Math.floor(diff/2592e6),timeUnit=1===readableDiff?"month":"months"):diff>864e5?(readableDiff=Math.floor(diff/864e5),timeUnit=1===readableDiff?"day":"days"):diff>36e5?(readableDiff=Math.floor(diff/36e5),timeUnit=1===readableDiff?"hour":"hours"):diff>6e4?(readableDiff=Math.floor(diff/6e4),timeUnit=1===readableDiff?"minute":"minutes"):(readableDiff=Math.floor(diff/1e3),timeUnit=1===readableDiff?"second":"seconds"),readableDiff+" "+timeUnit+" ago"}}}}]).directive("fillWindow",["$timeout",function($timeout){return{scope:{subtractElems:"@",applyToChildren:"@",additionalOffset:"@",ignore:"@"},link:function(scope,element,attrs){function resizeElements(){var windowWidth=angular.isDefined(attrs.windowWidth)?attrs.windowWidth:window.innerWidth;if(resize=!0,angular.isDefined(scope.ignore)){var ignoreSizes=scope.ignore.split(";");angular.forEach(ignoreSizes,function(size){windowWidth>=screenSizes[size].minWidth&&windowWidth<=screenSizes[size].maxWidth&&(resize=!1)}),resize?adjustElemHeight():resetHeight()}else adjustElemHeight()}function resetHeight(){if("true"!==scope.applyToChildren)element[0].style.minHeight="0px";else{var childElems=element[0].children;angular.forEach(childElems,function(child){child.style.minHeight="0px"})}}function adjustElemHeight(){resetHeight();var documentHeight=document.documentElement.scrollHeight>document.documentElement.clientHeight?document.documentElement.scrollHeight:document.documentElement.clientHeight,subtractHeight=0;if(angular.isDefined(scope.subtractElems)&&""!==scope.subtractElems){var elements=scope.subtractElems.split(";");angular.forEach(elements,function(elem){subtractHeight+=parseFloat(window.getComputedStyle(document.getElementsByClassName(elem)[0]).height)})}if(subtractHeight+=element[0].offsetTop,"true"!==scope.applyToChildren)element[0].style.minHeight=documentHeight-subtractHeight-(angular.isUndefined(scope.additionalOffset)?0:scope.additionalOffset)+"px";else{var childElems=element[0].children;angular.forEach(childElems,function(child){child.style.minHeight=documentHeight-subtractHeight-(angular.isUndefined(scope.additionalOffset)?0:scope.additionalOffset)+"px"})}}function checkElementHeights(){if("true"!==scope.applyToChildren)parseInt(window.getComputedStyle(element[0]).height)>parseInt(window.getComputedStyle(element[0]).minHeight)&&resizeElements();else for(var childElems=element[0].children,i=0;i<childElems.length;i++)if(parseInt(window.getComputedStyle(childElems[i]).height)>parseInt(window.getComputedStyle(childElems[i]).minHeight)){resizeElements();break}}var timeout,screenSizes={"extra-small":{minWidth:0,maxWidth:767},small:{minWidth:768,maxWidth:991},medium:{minWidth:992,maxWidth:1199},large:{minWidth:1200,maxWidth:1/0}},resize=!0;scope.$watch(function(){resizeElements()}),window.onresize=function(){$timeout.cancel(timeout),resizeElements(),timeout=$timeout(function(){checkElementHeights()},50)}}}}]).directive("equalizeHeights",["$window",function($window){return{link:function(scope,element){function goThroughRows(){angular.forEach(targets,function(target,index){target.style.height="auto",0==index?(currentRowOffset=target.offsetTop,row.push(target),height=window.getComputedStyle(target).height):target.offsetTop!=currentRowOffset?(changeHeight(height),row=[],row.push(target),currentRowOffset=target.offsetTop,height=window.getComputedStyle(target).height):(row.push(target),parseFloat(window.getComputedStyle(target).height)>parseFloat(height)&&(height=window.getComputedStyle(target).height)),index==targets.length-1&&(row.push(target),parseFloat(window.getComputedStyle(target).height)>parseFloat(height)&&(height=window.getComputedStyle(target).height),changeHeight(height),row=[],currentRowOffset=0,height=0)})}function changeHeight(height){angular.forEach(row,function(target){target.style.height=height})}var targets=element[0].children,currentRowOffset=0,height=0,row=[];element[0].style.overflow="hidden",scope.$watch(function(){goThroughRows()}),angular.element($window).bind("resize",function(){goThroughRows()})}}}]).filter("capitalize",[function(){return function(input){return void 0!==input?(null!==input&&(input=input.toLowerCase()),input.substring(0,1).toUpperCase()+input.substring(1)):void 0}}]).filter("fileSize",[function(){return function(input){if(void 0!==input){var b=Math,c=b.log,d=1e3,e=c(input)/c(d)|0;return(input/b.pow(d,e)).toFixed(2)+" "+(e?"kMGTPEZY"[--e]+"B":"Bytes")}}}]);return app}),function(global,angular){"use strict";function ColumnProvider(DefaultColumnConfiguration,templateUrlList){function Column(config){return this instanceof Column?void angular.extend(this,config):new Column(config)}this.setDefaultOption=function(option){angular.extend(Column.prototype,option)},DefaultColumnConfiguration.headerTemplateUrl=templateUrlList.defaultHeader,this.setDefaultOption(DefaultColumnConfiguration),this.$get=function(){return Column}}var smartTableColumnModule=angular.module("smartTable.column",["smartTable.templateUrlList"]).constant("DefaultColumnConfiguration",{isSortable:!0,isEditable:!1,type:"text",headerTemplateUrl:"",map:"",label:"",sortPredicate:"",formatFunction:"",formatParameter:"",filterPredicate:"",cellTemplate:"",cellTemplateUrl:"",headerClass:"",cellClass:"",saving:!1,width:"",pinnedWidth:0});ColumnProvider.$inject=["DefaultColumnConfiguration","templateUrlList"],smartTableColumnModule.provider("Column",ColumnProvider),global.ColumnProvider=ColumnProvider}(window,angular),function(angular){"use strict";angular.module("smartTable.directives",["smartTable.templateUrlList","smartTable.templates","ui.bootstrap.position"]).directive("smartTable",["templateUrlList","DefaultTableConfiguration","$injector",function(templateList,defaultConfig,$injector){return{restrict:"EA",scope:{dataSource:"=rows",columnCollection:"=columns",config:"="},replace:"true",templateUrl:templateList.smartTable,controller:"SmartTableCtrl",link:function(scope,element,attr,ctrl){function setConfig(){var newConfig=angular.extend({},defaultConfig,scope.config),length=void 0!==scope.columns?scope.columns.length:0;if(scope.filters=[],ctrl.setGlobalConfig(newConfig),newConfig.dependencies)for(var x=0;x<newConfig.dependencies.length;x++)scope[newConfig.dependencies[x]]=$injector.get(newConfig.dependencies[x]);if("multiple"!==newConfig.selectionMode||newConfig.displaySelectionCheckbox!==!0)for(var i=length-1;i>=0;i--)scope.columns[i].isSelectionColumn===!0&&ctrl.removeColumn(i);else ctrl.insertColumn({cellTemplateUrl:templateList.selectionCheckbox,headerTemplateUrl:templateList.selectAllCheckbox,isSelectionColumn:!0,isSortable:!1,cellClass:"smart-table-checkbox-cell",headerClass:"smart-table-checkbox-header-cell",pinnedWidth:32},0);angular.isDefined(newConfig.manageActions)&&newConfig.editDeleteBtns!==!0&&newConfig.manageBtns!==!0&&ctrl.insertColumn({cellTemplate:"<manage-table-btn></manage-table-btn>",isSortable:!1,cellClass:"smart-table-manage-cell",headerClass:"smart-table-header-manage-cell"},scope.columns.length),newConfig.editDeleteBtns===!0&&ctrl.insertColumn({cellTemplate:"<table-edit-delete></table-edit-delete>",isSortable:!1},scope.columns.length),angular.isDefined(scope.config.search)&&scope.$watch("config.search",function(value){ctrl.search(value)},!0),newConfig.useServer||scope.$watch("dataSource.length",function(newValue,oldValue){oldValue!==newValue&&(scope.dataCollection=scope.dataSource,scope.noResults=0===scope.dataCollection.length?!0:!1,ctrl.setRowsLength(),ctrl.sortBy())})}if(scope.columnCollection)for(var i=0,l=scope.columnCollection.length;l>i;i++)ctrl.insertColumn(scope.columnCollection[i]);scope.config.useServer=angular.isDefined(scope.dataSource)?!1:!0,scope.$watch("filters.length",function(newValue,oldValue){newValue!==oldValue&&(scope.currentPage=1,ctrl.filterTable())}),setConfig(),ctrl.intialize()}}}]).directive("smartTableDataRow",["$compile","$position","$document",function($compile,$position,$document){return{require:"^smartTable",restrict:"C",link:function(scope,element,attr,ctrl){var template,templateCreated=!1;scope.$watch("dataRow.saving",function(saving){saving?(templateCreated=!0,scope.position=$position.offset(element),template=angular.element("<div class=\"table-row-saving\" ng-style=\"{width: position.width + 'px', height: position.height + 'px', left: position.left + 'px', top: position.top + 'px'}\"><div class='row-saving-inner'>Saving</div></div>"),$compile(template)(scope),$document.find("body").append(template)):templateCreated&&template.remove()});var _config;null!=(_config=scope.config)&&"function"==typeof _config.rowFunction&&_config.rowFunction(scope,element,attr,ctrl),element.bind("click",function(){scope.$apply(function(){ctrl.toggleSelection(scope.dataRow)})})}}}]).directive("smartTableHeaderCell",function(){return{restrict:"C",require:"^smartTable",link:function(scope,element,attr,ctrl){element.bind("click",function(event){"INPUT"!==event.target.nodeName&&0!==event.target.cellIndex&&scope.column.isSortable&&scope.$apply(function(){ctrl.sortBy(scope.column)})})}}}).directive("smartTableSelectAll",function(){return{restrict:"C",require:"^smartTable",link:function(scope,element,attr,ctrl){element.bind("click",function(){ctrl.toggleSelectionAll(element[0].checked===!0)})}}}).directive("stopEvent",function(){return{restrict:"A",link:function(scope,element,attr){element.bind(attr.stopEvent,function(e){e.stopPropagation()})}}}).directive("smartTableGlobalSearch",["templateUrlList",function(templateList){return{restrict:"C",require:"^smartTable",scope:{columnSpan:"@"},templateUrl:templateList.smartTableGlobalSearch,replace:!1,link:function(scope,element,attr,ctrl){scope.searchValue="",scope.$watch("searchValue",function(value){""!==value&&ctrl.search(value)})}}}]).directive("smartTableSearch",["templateUrlList",function(templateList){return{restrict:"C",require:"^smartTable",scope:{columnSpan:"@"},templateUrl:templateList.smartTableSearch,replace:!1,link:function(scope,element,attr,ctrl){scope.searchValue="",scope.$watch("searchValue",function(value,newValue){value!==newValue&&ctrl.search(value)}),element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){ctrl.search(scope.searchValue,null,!0)}),event.preventDefault())})}}}]).directive("tableApplyAction",function(){return{restrict:"C",templateUrl:"../ambassador/templates/table/table.apply-action.html",require:"^smartTable",link:function(scope,element,attrs,ctrl){function getSelected(){var i,l=scope.displayedCollection.length,rowsSelected=[];for(i=0;l>i;i++)scope.displayedCollection[i].isSelected&&rowsSelected.push(scope.displayedCollection[i]);return rowsSelected}scope.action=function(action){var selected=getSelected();selected.length>0&&action(selected,function(tableAction){ctrl.toggleSelectionAll(!1),void 0!==tableAction&&("deleteRows"===tableAction?ctrl[tableAction](selected):ctrl[tableAction]())})}}}}).directive("displayPerPage",function(){return{restrict:"E",templateUrl:"../ambassador/templates/table/table.display-per-page.html",require:"^smartTable",link:function(scope,element,attrs,ctrl){function capitaliseFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)}scope.$watch("apiEndpoint",function(){angular.isDefined(scope.apiEndpoint)&&(scope.label=scope.paginateLabel||capitaliseFirstLetter(scope.apiEndpoint))}),scope.pageResults=[{text:"10 results",value:10},{text:"25 results",value:25},{text:"50 results",value:50},{text:"100 results",value:100}],scope.setDisplayPerPage=function(value){scope.itemsByPage=value,scope.currentPage=1,scope.useServer?ctrl.updateTable():(scope.displayedCollection=ctrl.pipe(scope.dataCollection),ctrl.setPageDisplay())}}}}).directive("manageTableBtn",function(){return{restrict:"E",templateUrl:"../ambassador/templates/table/table.manage-action-dropdown.html",require:"^smartTable",link:function(scope,element,attrs,ctrl){var status=["Zero Comm.","Approved","Denied"];scope.statusText=status[parseInt(scope.dataRow.is_approved,10)],scope.action=function(action){action(scope.dataRow,function(){ctrl.updateTable()})},scope.isZero=function(amount){return 0===parseFloat(amount)}}}}).directive("tableEditDelete",function(){return{restrict:"E",templateUrl:"../ambassador/templates/table/table.manage-action-buttons.html",require:"^smartTable",link:function(scope,element,attrs,ctrl){scope.action=function(action){action(scope.dataRow,function(tableAction){void 0!==tableAction&&ctrl[tableAction](scope.dataRow)})}}}}).directive("tooltipCell",function(){return{restrict:"E",templateUrl:"../ambassador/templates/table/table.tooltip-cell.html",require:"^smartTable",link:function(){}}}).directive("smartTableDataCell",["$filter","$http","$templateCache","$compile","$parse",function(filter,http,templateCache,compile,parse){return{restrict:"C",link:function(scope,element){function defaultContent(){column.isEditable?(element.html('<div editable-cell="" row="dataRow" column="column" type="column.type"></div>'),compile(element.contents())(scope)):element.text(scope.formatedValue)}var childScope,column=scope.column,isSimpleCell=!column.isEditable,row=scope.dataRow,format=filter("format"),getter=parse(column.map);scope.$watch("dataRow",function(){scope.formatedValue=format(getter(row),column.formatFunction,column.formatParameter),isSimpleCell===!0&&element.text(scope.formatedValue)},!0),scope.$watchCollection("[column.cellTemplate, column.cellTemplateUrl]",function(oldValue,newValue){newValue[0]?(isSimpleCell=!1,childScope=scope.$new(),element.html(newValue[0]),compile(element.contents())(childScope)):newValue[1]?http.get(newValue[1],{cache:templateCache}).success(function(response){isSimpleCell=!1,childScope=scope.$new(),element.html(response),compile(element.contents())(childScope)}).error(defaultContent):defaultContent()})}}}]).directive("inputType",function(){return{restrict:"A",priority:1,link:function(scope,ielement,iattr){var type=scope.$eval(iattr.type);iattr.$set("type",type)}}}).directive("editableCell",["templateUrlList","$parse",function(templateList,parse){return{restrict:"EA",require:"^smartTable",templateUrl:templateList.editableCell,scope:{row:"=",column:"=",type:"="},replace:!0,link:function(scope,element,attrs,ctrl){var form=angular.element(element.children()[1]),input=angular.element(form.children()[0]),getter=parse(scope.column.map);scope.isEditMode=!1,scope.$watch("row",function(){scope.value=getter(scope.row)},!0),scope.submit=function(){scope.myForm.$valid===!0&&(ctrl.updateDataRow(scope.row,scope.column.map,scope.value),ctrl.sortBy()),scope.toggleEditMode()},scope.toggleEditMode=function(){scope.value=getter(scope.row),scope.isEditMode=scope.isEditMode!==!0},scope.$watch("isEditMode",function(newValue){newValue===!0&&(input[0].select(),input[0].focus())}),input.bind("blur",function(){scope.$apply(function(){scope.submit()})})}}}])}(angular),function(angular){"use strict";angular.module("smartTable.filters",[]).constant("DefaultFilters",["currency","date","json","lowercase","number","uppercase"]).filter("format",["$filter","DefaultFilters",function(filter,defaultfilters){return function(value,formatFunction,filterParameter){var returnFunction;return(returnFunction=formatFunction&&angular.isFunction(formatFunction)?formatFunction:-1!==defaultfilters.indexOf(formatFunction)?filter(formatFunction):function(value){return value})(value,filterParameter)}}])}(angular),function(angular){"use strict";angular.module("smartTable.table",["smartTable.column","smartTable.utilities","smartTable.directives","smartTable.filters","ui.bootstrap.pagination.smartTable"]).constant("DefaultTableConfiguration",{selectionMode:"none",isGlobalSearchActivated:!1,displaySelectionCheckbox:!1,isPaginationEnabled:!0,isTopPaginationEnabled:!1,itemsByPage:10,maxSize:5,dependencies:[],apiEndpoint:"",tableClass:"",defaultParams:{},sortAlgorithm:"",filterAlgorithm:"",tablePinnedCols:0,tablePinnedHeight:0}).controller("SmartTableCtrl",["$scope","$rootScope","Column","$filter","$parse","ArrayUtility","DefaultTableConfiguration","$api","$alert","$timeout","$promiseKeeper",function(scope,rootScope,Column,filter,parse,arrayUtility,defaultConfig,$api,$alert,$timeout,$promiseKeeper){function isAllSelected(){var i,l=scope.displayedCollection.length;for(i=0;l>i;i++)if(scope.displayedCollection[i].isSelected!==!0)return!1;return!0}function sortDataRow(array,column){var sortAlgo=(scope.sortAlgorithm&&angular.isFunction(scope.sortAlgorithm))===!0?scope.sortAlgorithm:filter("orderBy");return column?arrayUtility.sort(array,sortAlgo,column.sortPredicate,column.reverse):array}function selectDataRow(array,selectionMode,index,select){var dataRow,oldValue;if(angular.isArray(array)&&("multiple"===selectionMode||"single"===selectionMode)&&index>=0&&index<array.length){if(dataRow=array[index],"single"===selectionMode)for(var i=0,l=array.length;l>i;i++)oldValue=array[i].isSelected,array[i].isSelected=!1,oldValue===!0&&scope.$emit("selectionChange",{item:array[i]});dataRow.isSelected=select,scope.holder.isAllSelected=isAllSelected(),scope.$emit("selectionChange",{item:dataRow})}}function setOrdering(column){return column.reverse?"-"+column.sortPredicate:column.sortPredicate}function parseFilters(filtersArray){var filters={};return angular.isDefined(filtersArray)&&0!==filtersArray.length?(filtersArray.forEach(function(filter){filters[filter.param]=filter.param_val}),filters):filters}function filterTableServer(data){scope.displayedCollection=data,scope.totalRows=data.count,self.calculateNumberOfPages(scope.totalRows),self.setPageDisplay()
}function useServer(){self.getData().then(function(data){filterTableServer(data)})}function checkFilterFuncs(){for(var i=0,l=scope.filters.length;l>i;i++)if(void 0===scope.filters[i].filterFunc)return!0;return!1}scope.columns=[],scope.dataCollection=scope.dataSource||[],scope.displayedCollection=[],scope.numberOfPages=0,scope.currentPage=1,scope.holder={isAllSelected:!1},scope.useServer=!1,scope.tableLoader=!1,scope.noResults=!1,scope.searchActive=!1;var lastColumnSort,search,predicate={},self=this;scope.getPinnedStyle=function(colIndex,type){var width=0,left=1,style={};if("data"===type){for(var i=0;colIndex+1>i;i++)width=scope.columns[i].pinnedWidth,left+=scope.columns[i].pinnedWidth;colIndex<scope.tablePinnedCols&&(style={width:width+"px",left:left-width+"px"}),scope.tablePinnedHeight&&(style.height=scope.tablePinnedHeight+"px")}else if("header"===type){style={};for(var i=0;colIndex+1>i;i++)width=scope.columns[i].pinnedWidth,left+=scope.columns[i].pinnedWidth;scope.columns[colIndex].width&&(style.width=scope.columns[colIndex].width),colIndex<scope.tablePinnedCols&&(style={width:width+"px","min-width":width+"px",left:left-width+"px"})}else if("table"===type){for(var margin=0,i=0;i<scope.tablePinnedCols;i++)margin+=scope.columns[i].pinnedWidth;style["margin-left"]=margin-1}return style},scope.getPinnedPadding=function(){for(var style,padding=0,i=0;i<scope.tablePinnedCols;i++)padding+=scope.columns[i].pinnedWidth;return style={"padding-left":padding+"px"}},scope.$on("EXPORT_COLLECTION",function(){scope.tableData.displayedCollection=scope.displayedCollection}),scope.$on("UPDATE_TABLE",function(){self.updateTable()}),this.setRowsLength=function(){scope.totalRows=scope.dataCollection.length},this.calculateNumberOfPages=function(total){scope.numberOfPages=0===total||scope.itemsByPage<1?1:Math.ceil(total/scope.itemsByPage)},this.setPageDisplay=function(){var rowsShowing=scope.itemsByPage;scope.pageStartNumber=(scope.currentPage-1)*rowsShowing+1,scope.pageEndNumber=(scope.currentPage-1)*rowsShowing+scope.displayedCollection.length},this.setGlobalConfig=function(config){angular.extend(scope,defaultConfig,config)},this.changePage=function(page){var oldPage=scope.currentPage;angular.isNumber(page.page)&&(scope.currentPage=page.page,scope.useServer?this.getData().then(function(data){filterTableServer(data)}):(scope.displayedCollection=this.pipe(scope.dataCollection),scope.holder.isAllSelected=isAllSelected(),this.setPageDisplay(),scope.$emit("changePage",{oldValue:oldPage,newValue:scope.currentPage})))},this.sortBy=function(column){var index=scope.columns.indexOf(column);-1!==index&&column.isSortable===!0&&(lastColumnSort&&lastColumnSort!==column&&(lastColumnSort.reverse="none"),column.sortPredicate=column.sortPredicate||column.map,column.reverse=column.reverse!==!0,lastColumnSort=column),scope.useServer?this.getData(column).then(function(data){filterTableServer(data)}):(scope.displayedCollection=this.pipe(scope.dataCollection),this.setPageDisplay())},this.sortByNonColumn=function(params){lastColumnSort=params,scope.useServer?this.getData(params).then(function(data){filterTableServer(data)}):(scope.displayedCollection=this.pipe(scope.dataCollection),this.setPageDisplay())},this.search=function(input,column,instant){scope.config.search=input,instant===!0?($timeout.cancel(search),scope.currentPage=1,self.getData().then(function(data){filterTableServer(data)})):(scope.searchActive&&(column&&-1!==scope.columns.indexOf(column)?predicate[column.map]=input:predicate={$:input},scope.useServer?(void 0!==search&&$timeout.cancel(search),search=$timeout(function(){scope.currentPage=1,self.getData().then(function(data){filterTableServer(data)})},1500)):(scope.currentPage=1,scope.displayedCollection=this.pipe(scope.dataCollection))),scope.searchActive=!0)},this.pipe=function(array){var output,filterAlgo=(scope.filterAlgorithm&&angular.isFunction(scope.filterAlgorithm))===!0?scope.filterAlgorithm:filter("filter");return output=sortDataRow(arrayUtility.filter(array,filterAlgo,predicate),lastColumnSort),this.calculateNumberOfPages(scope.totalRows),scope.isPaginationEnabled?arrayUtility.fromTo(output,(scope.currentPage-1)*scope.itemsByPage,scope.itemsByPage):output},this.updateTable=function(){this.getData().then(function(data){filterTableServer(data),rootScope.$broadcast("TABLE_UPDATED")})},this.filterTable=function(){var filtered;scope.useServer||checkFilterFuncs()?useServer():(filtered=scope.dataCollection,angular.forEach(scope.filters,function(filter){filtered=filtered.filter(function(item){return filter.filterFunc(item,filter)})}),scope.totalRows=filtered.length,scope.displayedCollection=this.pipe(filtered),this.setPageDisplay())},this.getData=function(column){var data,searchConfig={},filters=parseFilters(scope.filters),search=void 0===scope.config.search||""===scope.config.search?{}:{search:scope.config.search},orderParam=scope.config.displayTopAmbassadorsOrdering?"stat":"ordering";scope.noResults=!1,(scope.currentPage-1)*scope.itemsByPage>=scope.totalRows-scope.deletingRows&&(scope.currentPage>1&&scope.currentPage--,scope.deletingRows=0),angular.extend(searchConfig,scope.defaultParams,search,filters,{page:scope.currentPage,page_size:scope.itemsByPage}),void 0!==lastColumnSort?searchConfig[orderParam]=setOrdering(lastColumnSort):void 0!==column?searchConfig[orderParam]=setOrdering(column):void 0!==scope.startingOrder&&(searchConfig[orderParam]=scope.startingOrder);var tableLoader;return $promiseKeeper.getActive()?tableLoader=$promiseKeeper.add():scope.tableLoader=!0,data=$api.all(scope.apiEndpoint).getList(searchConfig),data.then(function(results){0===results.length&&(scope.noResults=!0),scope.tableLoader=!1,void 0!==tableLoader&&tableLoader.deferred.resolve()},function(){scope.noResults=!0,scope.tableLoader=!1,void 0!==tableLoader&&tableLoader.deferred.resolve()}),data},this.intialize=function(){var tableLoader=$promiseKeeper.add();scope.deletingRows=0;var searchConfig={},filters=void 0!==scope.filters&&0!==scope.filters.length?parseFilters(scope.filters):{},orderParam=scope.config.displayTopAmbassadorsOrdering?"stat":"ordering";angular.isDefined(scope.startingOrder)&&(searchConfig[orderParam]=scope.startingOrder),scope.useServer?(angular.extend(searchConfig,scope.defaultParams,filters,{page:1,page_size:scope.itemsByPage}),$api.all(scope.apiEndpoint).getList(searchConfig).then(function(data){scope.totalRows=data.count,scope.totalRows>100&&(scope.useServer=!0),0===scope.totalRows&&(scope.noResults=!0),scope.dataCollection=data,scope.displayedCollection=self.pipe(data),self.setPageDisplay(),tableLoader.deferred.resolve()})):(scope.totalRows=scope.dataCollection.length,0===scope.totalRows&&(scope.noResults=!0),this.sortBy(),this.setPageDisplay(),tableLoader.deferred.resolve())},this.insertColumn=function(columnConfig,index){var column=new Column(columnConfig);arrayUtility.insertAt(scope.columns,index,column)},this.removeColumn=function(columnIndex){arrayUtility.removeAt(scope.columns,columnIndex)},this.moveColumn=function(oldIndex,newIndex){arrayUtility.moveAt(scope.columns,oldIndex,newIndex)},this.clearColumns=function(){scope.columns.length=0},this.toggleSelection=function(dataRow){var index=scope.dataCollection.indexOf(dataRow);-1!==index&&selectDataRow(scope.dataCollection,scope.selectionMode,index,dataRow.isSelected!==!0)},this.toggleSelectionAll=function(value){var i=0,l=scope.displayedCollection.length;if("multiple"===scope.selectionMode)for(;l>i;i++)selectDataRow(scope.displayedCollection,scope.selectionMode,i,value===!0)},this.removeDataRow=function(rowIndex){var toRemove=arrayUtility.removeAt(scope.displayedCollection,rowIndex);arrayUtility.removeAt(scope.dataCollection,scope.dataCollection.indexOf(toRemove))},this.moveDataRow=function(oldIndex,newIndex){arrayUtility.moveAt(scope.displayedCollection,oldIndex,newIndex)},this.updateDataRow=function(dataRow,propertyName,newValue){var oldValue,index=scope.displayedCollection.indexOf(dataRow),getter=parse(propertyName),setter=getter.assign;-1!==index&&(oldValue=getter(scope.displayedCollection[index]),oldValue!==newValue&&(setter(scope.displayedCollection[index],newValue),scope.$emit("updateDataRow",{item:scope.displayedCollection[index]})))},this.deleteRow=function(dataRow){dataRow.remove().then(function(){var index=scope.displayedCollection.indexOf(dataRow);self.removeDataRow(index),scope.deletingRows=1,self.updateTable()})},this.deleteRows=function(dataRows){var count=dataRows.length;angular.forEach(dataRows,function(dataRow){dataRow.remove().then(function(){var index=scope.displayedCollection.indexOf(dataRow);self.removeDataRow(index),--count,0===count&&(scope.deletingRows=dataRows.length,self.updateTable())})})}}])}(angular),angular.module("smartTable.templates",["partials/defaultCell.html","partials/defaultHeader.html","partials/editableCell.html","partials/globalSearchCell.html","partials/searchCell.html","partials/pagination.html","partials/selectAllCheckbox.html","partials/selectionCheckbox.html","partials/smartTable.html"]),angular.module("partials/defaultCell.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("partials/defaultCell.html","{{formatedValue}}")}]),angular.module("partials/defaultHeader.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("partials/defaultHeader.html",'<span class="header-content" ng-class="{\'sort-ascent\':column.reverse==false,\'sort-descent\':column.reverse==true}" ng-bind-html="column.label"></span>')}]),angular.module("partials/editableCell.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("partials/editableCell.html",'<div ng-dblclick="toggleEditMode($event)">\n    <span ng-hide="isEditMode">{{value | format:column.formatFunction:column.formatParameter}}</span>\n\n    <form ng-submit="submit()" ng-show="isEditMode" name="myForm">\n        <input name="myInput" ng-model="value" type="type" input-type/>\n    </form>\n</div>')}]),angular.module("partials/globalSearchCell.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("partials/globalSearchCell.html",'<label>Search :</label>\n<input type="text" ng-model="searchValue"/>')}]),angular.module("partials/searchCell.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("partials/searchCell.html",'<input type="text" ng-model="searchValue" class="form-control" placeholder="Search"/>')}]),angular.module("partials/pagination.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("partials/pagination.html",'<ul class="pagination">\n   <li ng-repeat="page in pages" ng-class="{active: page.active, disabled: page.disabled}"><a\n ng-click="selectPage(page.number)">{{page.text}}</a></li>\n</ul>\n')}]),angular.module("partials/selectAllCheckbox.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("partials/selectAllCheckbox.html",'<input class="smart-table-select-all"  type="checkbox" ng-model="holder.isAllSelected"/>')}]),angular.module("partials/selectionCheckbox.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("partials/selectionCheckbox.html",'<input type="checkbox" ng-model="dataRow.isSelected" stop-event="click"/>')}]),angular.module("partials/smartTable.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("partials/smartTable.html",'<div class="container-fluid smart-table-container">    <ga-loader loading="tableLoader"></ga-loader>\n    <div class="row smart-table-header">\n       <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">         <div ng-if="displaySelectionCheckbox" class="table-apply-action-container">\n             <div class="table-apply-action"></div>\n         </div>\n         <div ng-if="config.tableFilters.length > 0" class="table-filter-container">             <table-filters config="config.tableFilters" filters="filters"></table-filters>         </div>       </div>       <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12 pull-right smart-table-search">\n       </div>\n       <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 pull-right">\n           <display-per-page></display-per-page>\n       </div>\n    </div>\n    <div class="smart-table-outer-wrapper">\n       <div class="smart-table-wrapper" ng-class="{ \'smart-table-pinned\': tablePinnedCols!==0, \'smart-table-highlights\':displayColumnHighlights===true, \'smart-table-no-results\': noResults }">\n           <table class="smart-table table table-striped {{tableClass}} pinned-{{tablePinnedCols}}" ng-style="getPinnedStyle($index,\'table\')" ng-class="{ pinned: tablePinnedCols!==0 }">\n               <thead>\n                   <tr class="smart-table-global-search-row" ng-if="isGlobalSearchActivated">\n                       <td class="smart-table-global-search" column-span="{{columns.length}}" colspan="{{columnSpan}}">\n                       </td>\n                   </tr>\n                   <tr class="smart-table-header-row">\n                       <th ng-repeat="column in columns" ng-include="column.headerTemplateUrl"\n                       class="smart-table-header-cell {{column.headerClass}}" ng-style="getPinnedStyle($index,\'header\')" ng-class="{\'smart-table-disabled-sort\': column.isSortable===false}" scope="col">\n                       </th>\n                   </tr>\n               </thead>\n               <tbody>\n                   <tr ng-repeat="dataRow in displayedCollection" ng-class="{selected:dataRow.isSelected}"\n                   class="smart-table-data-row">\n                       <td ng-repeat="column in columns" class="smart-table-data-cell {{column.cellClass}}" ng-style="getPinnedStyle($index,\'data\')"></td>\n                   </tr>\n                   <tr class="smart-table-no-results-row" ng-if="noResults">\n                       <td class="smart-table-no-results-cell" column-span="{{columns.length}}" colspan="{{columns.length}}">No results found.</td>\n                   </tr>\n               </tbody>\n               <tfoot ng-show="isPaginationEnabled">\n                   <tr class="smart-table-footer-row">\n                   </tr>\n               </tfoot>\n           </table>\n       </div>\n    </div>\n    <div class="smart-table-footer">\n       <div pagination-smart-table="" num-pages="numberOfPages" max-size="maxSize" current-page="currentPage" previous-text="<" next-text=">"></div>\n    </div>\n</div>\n\n\n')}]),function(angular){"use strict";angular.module("smartTable.templateUrlList",[]).constant("templateUrlList",{smartTable:"partials/smartTable.html",smartTableGlobalSearch:"partials/globalSearchCell.html",smartTableSearch:"partials/searchCell.html",editableCell:"partials/editableCell.html",selectionCheckbox:"partials/selectionCheckbox.html",selectAllCheckbox:"partials/selectAllCheckbox.html",defaultHeader:"partials/defaultHeader.html",pagination:"partials/pagination.html"})}(angular),function(angular){"use strict";angular.module("smartTable.utilities",[]).factory("ArrayUtility",function(){var removeAt=function(arrayRef,index){return index>=0&&index<arrayRef.length?arrayRef.splice(index,1)[0]:void 0},insertAt=function(arrayRef,index,item){index>=0&&index<arrayRef.length?arrayRef.splice(index,0,item):arrayRef.push(item)},moveAt=function(arrayRef,oldIndex,newIndex){var elementToMove;oldIndex>=0&&oldIndex<arrayRef.length&&newIndex>=0&&newIndex<arrayRef.length&&(elementToMove=arrayRef.splice(oldIndex,1)[0],arrayRef.splice(newIndex,0,elementToMove))},sort=function(arrayRef,sortAlgorithm,predicate,reverse){return sortAlgorithm&&angular.isFunction(sortAlgorithm)?sortAlgorithm(arrayRef,predicate,reverse===!0):arrayRef},filter=function(arrayRef,filterAlgorithm,predicate){return filterAlgorithm&&angular.isFunction(filterAlgorithm)?filterAlgorithm(arrayRef,predicate):arrayRef},fromTo=function(arrayRef,min,length){var limit,start,out=[];if(!angular.isArray(arrayRef))return arrayRef;start=Math.max(min,0),start=Math.min(start,arrayRef.length-1>0?arrayRef.length-1:0),length=Math.max(0,length),limit=Math.min(start+length,arrayRef.length);for(var i=start;limit>i;i++)out.push(arrayRef[i]);return out};return{removeAt:removeAt,insertAt:insertAt,moveAt:moveAt,sort:sort,filter:filter,fromTo:fromTo}})}(angular),function(angular){angular.module("ui.bootstrap.pagination.smartTable",["smartTable.templateUrlList"]).constant("paginationConfig",{boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"<",nextText:">",lastText:"Last"}).directive("paginationSmartTable",["paginationConfig","templateUrlList",function(paginationConfig,templateUrlList){return{restrict:"EA",require:"^smartTable",scope:{numPages:"=",currentPage:"=",maxSize:"="},templateUrl:templateUrlList.pagination,replace:!0,link:function(scope,element,attrs,ctrl){function makePage(number,text,isActive,isDisabled){return{number:number,text:text,active:isActive,disabled:isDisabled}}var boundaryLinks=angular.isDefined(attrs.boundaryLinks)?scope.$eval(attrs.boundaryLinks):paginationConfig.boundaryLinks,directionLinks=angular.isDefined(attrs.directionLinks)?scope.$eval(attrs.directionLinks):paginationConfig.directionLinks,firstText=angular.isDefined(attrs.firstText)?attrs.firstText:paginationConfig.firstText,previousText=angular.isDefined(attrs.previousText)?attrs.previousText:paginationConfig.previousText,nextText=angular.isDefined(attrs.nextText)?attrs.nextText:paginationConfig.nextText,lastText=angular.isDefined(attrs.lastText)?attrs.lastText:paginationConfig.lastText;scope.$watch("numPages + currentPage + maxSize",function(){scope.pages=[];var startPage=1,endPage=scope.numPages;scope.maxSize&&scope.maxSize<scope.numPages&&(startPage=Math.max(scope.currentPage-Math.floor(scope.maxSize/2),1),endPage=startPage+scope.maxSize-1,endPage>scope.numPages&&(endPage=scope.numPages,startPage=endPage-scope.maxSize+1));for(var number=startPage;endPage>=number;number++){var page=makePage(number,number,scope.isActive(number),!1);scope.pages.push(page)}if(directionLinks){var previousPage=makePage(scope.currentPage-1,previousText,!1,scope.noPrevious());scope.pages.unshift(previousPage);var nextPage=makePage(scope.currentPage+1,nextText,!1,scope.noNext());scope.pages.push(nextPage)}if(boundaryLinks){var firstPage=makePage(1,firstText,!1,scope.noPrevious());scope.pages.unshift(firstPage);var lastPage=makePage(scope.numPages,lastText,!1,scope.noNext());scope.pages.push(lastPage)}scope.currentPage>scope.numPages&&scope.selectPage(scope.numPages)}),scope.noPrevious=function(){return 1===scope.currentPage},scope.noNext=function(){return scope.currentPage===scope.numPages},scope.isActive=function(page){return scope.currentPage===page},scope.selectPage=function(page){!scope.isActive(page)&&page>0&&page<=scope.numPages&&(scope.currentPage=page,ctrl.changePage({page:page}))}}}}])}(angular),function(angular){angular.module("ambassador.table.filters",[]).directive("tableFilters",["$filter","$api",function(){return{restrict:"E",scope:{filters:"=",config:"=",loadTable:"=",filterSetType:"@"},controller:"tableFilterCtrl",templateUrl:"../ambassador/templates/table/table.filter.html",link:function(scope,elm,attrs,ctrl){function Filter(config){this.label=config.label,this.param=config.param,this.param_val=null,this.val_label=config.displayParam,angular.isDefined(config.filterFunc)&&(this.filterFunc=config.filterFunc)}function formatDate(date){return date=String(date),1===date.length?"0"+date:date}function checkCurrentFilters(newFilter){return angular.forEach(scope.filters,function(filter){return filter.template===newFilter.template?!0:void 0}),!1}scope.selectFilter=function(filter){scope.selectedFilter=filter},scope.selectOption=function(value){scope.filterValue=value,scope.addFilter(scope.selectedFilter,scope.filterValue)},scope.addFilter=function(filter,value){var newFilter;""!==scope.filterValue&&(value=scope.filterValue),""===value||checkCurrentFilters(filter)||(newFilter=new Filter(filter),"calender"===filter.template?(newFilter.param_val=formatDate(value),newFilter.val_label=newFilter.param_val):void 0!==filter.options?(newFilter.param_val=value.value,newFilter.val_label=value.label):(newFilter.param_val=value,newFilter.val_label=value[newFilter.val_label]),scope.filters.push(newFilter),scope.selectedFilter="")},scope.removeFilter=function(filter){scope.filters=_.without(scope.filters,filter)},scope.clearAll=function(){scope.filters.length=0},scope.filterSelected=function(item){if(0===scope.filters.length)return item;for(var found=!0,i=0;i<scope.filters.length;i++){if(item.param===scope.filters[i].param){found=!0;break}found=!1}return found?void 0:item},void 0!==scope.config&&ctrl.setConfig(scope.config)}}}]).directive("tableFilterInput",["$compile",function($compile){return{restrict:"E",require:"^tableFilters",link:function(scope,elm,attrs,ctrl){function compileInput(filterTemp){elm.html(filterTemp?"typeahead"===filterTemp&&scope.async.active?templates.typeaheadAsync:templates[filterTemp]:""),$compile(elm.contents())(scope)}var templates={text:'<div class="input-group"><input ng-model="filterValue" ng-enter="addFilter(selectedFilter, filterValue)" class="form-control" type="text"><span class="input-group-btn"><button ng-click="addFilter(selectedFilter, filterValue)" class="btn btn-default" type="button"><i class="fa fa-plus"></i></button></span></div>',select:'<div class="dropdown"><a class="dropdown-toggle btn btn-default"> Select an option <i class="fa fa-caret-down"></i></a><ul class="dropdown-menu"><li ng-repeat="o in activeFilter.options"><a ng-click="selectOption(o)">{{o.label}}</a></li></ul></div>',typeahead:'<div><input ng-if="!useDropdown && !useCustomSearch" type="text" ng-model="filterValue" placeholder="Search {{activeFilter.async.endpoint}}" typeahead="o as o[activeFilter.async.field] for o in typeaheadData | filter:{ {{activeFilter.async.field}}: $viewValue} | limitTo:10" typeahead-on-select="addFilter(selectedFilter, filterValue)" typeahead-template-url="../ambassador/templates/table/table.typeahead-filter-template.html" class="form-control"><input ng-if="!useDropdown && useCustomSearch" type="text" ng-model="filterValue" placeholder="Search {{activeFilter.async.endpoint}}" typeahead="o as o[activeFilter.async.field] for o in customSearch($viewValue) | limitTo:10" typeahead-on-select="addFilter(selectedFilter, filterValue)" typeahead-template-url="../ambassador/templates/table/table.typeahead-filter-template.html" class="form-control"><div ng-if="useDropdown" class="dropdown dropdown-select dropdown-form"><a class="dropdown-toggle btn btn-default">Select {{activeFilter.async.endpoint}} <i class="fa fa-caret-down"></i></a><ul class="dropdown-menu pull-right"><li ng-repeat="o in typeaheadData"><a ng-click="addFilter(selectedFilter, o)"><span ng-if="activeFilter.async.displayPrefix !== undefined">{{o[activeFilter.async.displayPrefix]}} - </span>{{o[activeFilter.async.field]}}</a></li></ul></div></div>',typeaheadAsync:'<div class="async-loader"><input type="text" ng-model="filterValue" placeholder="Search {{activeFilter.async.endpoint}}" typeahead="o for o in asyncSearch($viewValue) | filter:{ activeFilter.async.field: $viewValue} | limitTo:15" typeahead-loading="async.loadingResults" typeahead-wait-ms="async.asyncWaitTime" typeahead-template-url="../ambassador/templates/table/table.typeahead-filter-template.html" typeahead-on-select="addFilter(selectedFilter, filterValue)" class="form-control"><i ng-show="async.loadingResults" class="fa fa-refresh fa-spin"></i></div>',calender:'<div class="input-group datepicker-input"><input type="text" class="form-control" ng-change="addFilter(selectedFilter, filterValue)" datepicker-popup="yyyy-MM-dd" ng-model="filterValue" ng-click="open($event)" is-open="opened" close-text="Close" show-weeks="false" show-button-bar="false" /><span class="input-group-btn"><button class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button></span></div>'};scope.$watch("selectedFilter",function(filter){""===filter?(compileInput(),scope.filterValue=""):(scope.activeFilter=filter,void 0!==filter.async&&ctrl.getData(filter),compileInput(filter.template))}),scope.$on("update-input",function(){compileInput(scope.activeFilter.template)}),scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),scope.opened=!0}}}}]).controller("tableFilterCtrl",["$scope","$api","$q",function($scope,$api,$q){var abortSearch;$scope.selectedFilter="",$scope.filterValue="",$scope.async={active:!0,loadingResults:!1,asyncWaitTime:500},$scope.activeFilter={},$scope.filterOptions=[],this.setConfig=function(config){angular.forEach(config,function(filter){$scope.filterOptions.push(filter)})},this.getData=function(filter){$api.all(filter.async.endpoint).getList({page_size:50}).then(function(data){data.count<50?($scope.async.active=!1,$scope.useCustomSearch=$scope.activeFilter.async.additional_field?!0:!1,$scope.typeaheadData=data):($scope.async.active=!0,$scope.useCustomSearch=!1),$scope.useDropdown=data.count<25?!0:!1,$scope.$broadcast("update-input")})},$scope.asyncSearch=function(value){return abortSearch&&abortSearch.resolve(),abortSearch=$q.defer(),$scope.async.loadingResults=!0,$api.all($scope.activeFilter.async.endpoint).withHttpConfig({timeout:abortSearch.promise}).getList({search:value,ordering:$scope.activeFilter.async.field}).then(function(data){return $scope.async.loadingResults=!1,data})},$scope.customSearch=function($viewValue){for(var matches=[],i=0;i<$scope.typeaheadData.length;i++)(-1!==$scope.typeaheadData[i][$scope.activeFilter.async.field].toString().toLowerCase().indexOf($viewValue.toLowerCase())||-1!==$scope.typeaheadData[i][$scope.activeFilter.async.additional_field].toString().toLowerCase().indexOf($viewValue.toLowerCase()))&&matches.push($scope.typeaheadData[i]);return matches}}])}(angular);