angular.module("ngAmbassador.misc",["ngAmbassador.services"]).directive("fillWindow",["$timeout",function($timeout){return{scope:{subtractElems:"@",applyToChildren:"@",additionalOffset:"@",ignore:"@"},link:function(scope,element,attrs){function resizeElements(){var windowWidth=angular.isDefined(attrs.windowWidth)?attrs.windowWidth:window.innerWidth;if(resize=!0,angular.isDefined(scope.ignore)){var ignoreSizes=scope.ignore.split(";");angular.forEach(ignoreSizes,function(size){windowWidth>=screenSizes[size].minWidth&&windowWidth<=screenSizes[size].maxWidth&&(resize=!1)}),resize?adjustElemHeight():resetHeight()}else adjustElemHeight()}function resetHeight(){if("true"!==scope.applyToChildren)element[0].style.minHeight="0px";else{var childElems=element[0].children;angular.forEach(childElems,function(child){child.style.minHeight="0px"})}}function adjustElemHeight(){resetHeight();var documentHeight=document.documentElement.scrollHeight>document.documentElement.clientHeight?document.documentElement.scrollHeight:document.documentElement.clientHeight,subtractHeight=0;if(angular.isDefined(scope.subtractElems)&&""!==scope.subtractElems){var elements=scope.subtractElems.split(";");angular.forEach(elements,function(elem){subtractHeight+=parseFloat(window.getComputedStyle(document.getElementsByClassName(elem)[0]).height)})}if(subtractHeight+=element[0].offsetTop,"true"!==scope.applyToChildren)element[0].style.minHeight=documentHeight-subtractHeight-(angular.isUndefined(scope.additionalOffset)?0:scope.additionalOffset)+"px";else{var childElems=element[0].children;angular.forEach(childElems,function(child){child.style.minHeight=documentHeight-subtractHeight-(angular.isUndefined(scope.additionalOffset)?0:scope.additionalOffset)+"px"})}}function checkElementHeights(){if("true"!==scope.applyToChildren)parseInt(window.getComputedStyle(element[0]).height)>parseInt(window.getComputedStyle(element[0]).minHeight)&&resizeElements();else for(var childElems=element[0].children,i=0;i<childElems.length;i++)if(parseInt(window.getComputedStyle(childElems[i]).height)>parseInt(window.getComputedStyle(childElems[i]).minHeight)){resizeElements();break}}var timeout,screenSizes={"extra-small":{minWidth:0,maxWidth:767},small:{minWidth:768,maxWidth:991},medium:{minWidth:992,maxWidth:1199},large:{minWidth:1200,maxWidth:1/0}},resize=!0;scope.$watch(function(){resizeElements()}),window.onresize=function(){$timeout.cancel(timeout),resizeElements(),timeout=$timeout(function(){checkElementHeights()},50)}}}}]).directive("clickAnywhereButHere",["$document",function($document){return{restrict:"A",link:function(scope,elem,attr){elem.bind("click",function(e){e.stopPropagation()}),$document.bind("click",function(){scope.$apply(attr.clickAnywhereButHere)})}}}]).directive("fillParent",["$window",function($window){return{link:function(scope,element){function setHeight(){var parentHeight=window.getComputedStyle(element.parent()[0]).height;element[0].style.minHeight=parentHeight}scope.$watch(function(){setHeight()}),angular.element($window).bind("resize",function(){setHeight()})}}}]).directive("equalizeHeights",["$window",function($window){return{link:function(scope,element){function goThroughRows(){angular.forEach(targets,function(target,index){target.style.height="auto",0==index?(currentRowOffset=target.offsetTop,row.push(target),height=window.getComputedStyle(target).height):target.offsetTop!=currentRowOffset?(changeHeight(height),row=[],row.push(target),currentRowOffset=target.offsetTop,height=window.getComputedStyle(target).height):(row.push(target),parseFloat(window.getComputedStyle(target).height)>parseFloat(height)&&(height=window.getComputedStyle(target).height)),index==targets.length-1&&(row.push(target),parseFloat(window.getComputedStyle(target).height)>parseFloat(height)&&(height=window.getComputedStyle(target).height),changeHeight(height),row=[],currentRowOffset=0,height=0)})}function changeHeight(height){angular.forEach(row,function(target){target.style.height=height})}var targets=element[0].children,currentRowOffset=0,height=0,row=[];element[0].style.overflow="hidden",scope.$watch(function(){goThroughRows()}),angular.element($window).bind("resize",function(){goThroughRows()})}}}]).directive("gaEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.gaEnter)}),event.preventDefault())})}}).directive("gaLoader",["$timeout",function($timeout){return{restrict:"E",replace:!0,template:'<div ng-class="{\'fade-in\':loading===true, \'fade-out\':loading===false }" class="ga-loader"><div ng-if="showLoader" class="ga-spinner"><span class="loader-text">Loading</span><svg class="spinner" width="100px" height="100px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg"><circle class="path" fill="none" stroke-width="5" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div>',scope:{loading:"="},link:function(scope){scope.showLoader=scope.loading===!0,scope.$watch("loading",function(){scope.loading?scope.showLoader=!0:$timeout(function(){scope.showLoader=!1},300)})}}}]).directive("gaValueTemplate",["$compile",function($compile){return{restrict:"E",scope:{value:"=",responsive:"=",compression:"=",min:"=",max:"=",scopeLevel:"@"},replace:!0,template:"<div ng-style='{fontSize:fontSize}'></div>",link:function(scope,element){element.html(scope.value),void 0===scope.scopeLevel&&(scope.scopeLevel=3);for(var valueScope=scope,i=1;i<=scope.scopeLevel;i++)valueScope=valueScope.$parent;$compile(element.contents())(valueScope),scope.compressor=scope.compression||1,scope.minFontSize=scope.min||Number.NEGATIVE_INFINITY,scope.maxFontSize=scope.max||Number.POSITIVE_INFINITY,scope.elementWidth=element[0].offsetWidth,scope.resizer=function(){scope.elementWidth=element[0].offsetWidth,scope.fontSize=Math.max(Math.min(scope.elementWidth/(10*scope.compressor),parseFloat(scope.maxFontSize)),parseFloat(scope.minFontSize))+"px"},scope.responsive&&(scope.resizer(),scope.$watch("value",function(){scope.resizer()}),angular.element(window).bind("resize",function(){scope.$apply(scope.resizer)}),scope.$watch(function(){return element[0].offsetWidth},function(){scope.resizer()}))}}}]).directive("gaCurrency",["$filter",function($filter){return{restrict:"E",replace:!0,scope:{type:"=",amount:"=",pointsLabel:"=",currency:"=",typesConfig:"="},template:"<div>{{displayAmount}}</div>",link:function(scope){var currencies={USD:"$",GBP:"£",SGD:"$",EUR:"€",AUD:"$",ZAR:"R",BRL:"R$",CAD:"$"},updateAmount=function(){var filter=$filter("currency"),amountTest=parseFloat(scope.amount);scope.displayAmount=angular.isDefined(scope.type)&&angular.isDefined(scope.typesConfig)&&-1!==scope.typesConfig.nonMonetary.indexOf(scope.type)?$filter("number")(scope.amount,2)+" "+scope.pointsLabel:filter(amountTest,currencies[scope.currency],2)};scope.$watch("amount",function(){updateAmount()})}}}]).directive("gaAvatar",["$filter",function(){return{restrict:"E",scope:{image:"=",disableFade:"=",alt:"@"},template:"<div class='ga-avatar'><img ng-src='{{image}}' ng-class='{ \"fade-in\": avatarLoaded===true }' ></div>",link:function(scope,element){scope.disableFade!==!0?element.find("img").bind("load",function(){scope.avatarLoaded=!0,scope.$$phase||scope.$apply()}):scope.avatarLoaded=!0}}}]);